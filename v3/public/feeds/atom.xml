<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://antongunnarsson.com</id>
    <title>Anton Gunnarsson</title>
    <updated>2022-04-15T10:43:28.409Z</updated>
    <generator>NextJS + feed package</generator>
    <author>
        <name>Anton Gunnarsson</name>
        <uri>https://antongunnarsson.com</uri>
    </author>
    <link rel="alternate" href="https://antongunnarsson.com"/>
    <link rel="self" href="https://antongunnarsson.com/feeds/atom.xml"/>
    <subtitle>test</subtitle>
    <rights>test</rights>
    <entry>
        <title type="html"><![CDATA[Code in the Dark]]></title>
        <id>https://antongunnarsson.com/posts/code-in-the-dark</id>
        <link href="https://antongunnarsson.com/posts/code-in-the-dark"/>
        <updated>2020-02-17T21:45:00.000Z</updated>
        <content type="html"><![CDATA[<p>Code in the Dark is a <em>programming</em> competition where participants try to recreate a design with just HTML &amp; CSS, <strong>without previewing it</strong>. Created by Tictail (now Shopify) back in 2013 there have now been similar events all over the world. I got to experience the excitement of just being in the audience at last year&#x27;s NordicJS which inspired me to host my own Code in the Dark-evening at work. These are some notes to my future self and anyone else who&#x27;d like to host a similar event.</p>
<h2>Preparations</h2>
<p>Before starting to prepare you need to set a goal for how many people do you want to participate. We ran four heats with four participants in each and a final with the winners from each heat. That was a total of 16 people, which also meant we had to prepare five different reference images that they were to recreate.</p>
<p>Talking of the reference images, I recommend keeping it simple and straight forward. One thing I found worked well was taking some well-known site, finding a component I liked and modding that with the DevTools to my liking. Here&#x27;s one I made of the GitHub pull request page:</p>
<h3>Editor</h3>
<p>When you&#x27;ve found images to use you need to decide if you want people to use their own editor or the <a href="https://github.com/codeinthedark/editor">open-source Code in the Dark-editor</a>. I really recommend the editor since it comes with some nifty stuff like an inline preview of the image, instructions for assets and a âœ¨<em>power mode</em>âœ¨ when you get a combo.</p>
<p>There is more info about setting up the editor in the GitHub repository, but if you plan on running the editors locally on participants&#x27; computers and might end up reusing some computer I noticed one thing. The editor stores it state in local storage, and since that is shared between every html page you open from file it will also be shared between heats if you reuse a computer. It&#x27;s not a big deal but just try to empty the local storage between heats to avoid confusion.</p>
<p>If the participants are expected to use their own computer, make sure you have a good way to transfer the editor to everyone. If you send it by email, do you have everyone&#x27;s email? If you transfer it from a USB stick, does it work with both Mac and Windows?</p>
<h3>How to win</h3>
<p>The recommended way to determine a winner is by audience vote. You could, of course, get a jury or similar but in my (relatively short) experience voting is what works best. It makes sure the audience is engaged and removes some prestige from the competition. We used the service <a href="https://www.mentimeter.com/">Mentimeter</a> which has a good free tier and support for live voting. One thing we didn&#x27;t do but that I will do next time is 1) show the reference image while the audience vote and 2) don&#x27;t show the votes live, but rather reveal the winner when the votes are in.</p>
<h4>Prize</h4>
<p>Talking about winning, you should also decide if you want the winner to receive a prize or just win the honor. Personally, I&#x27;m not interested in dealing out cash prizes or similar because for me that would remove the <em>silliness</em> of the competition. On the other hand, I&#x27;m really positive about having some sort of prize, so we ended up with a gift basket with <em>&quot;retro&quot;</em> stuff. It had a single-use camera, some old CDs, a vinyl and some other stuff. I think it worked really well, and it was cheap to get everything second-hand :)</p>
<h3>Presentation</h3>
<p>To simplify administration during the event I prepared a presentation that included some placeholder text for between the heats, a timer that counted down from 15 minutes and instructions for how to vote when the heat was over. I built the presentation with <a href="https://github.com/jxnblk/mdx-deck">mdx-deck</a> which is a way to build presentations with Markdown and React. Doing that enabled me to have an interactive presentation that I never had to leave in between the heats.</p>
<p>Here&#x27;s how some of the slides looked, but like said before I recommend having a slide for the reference image and not showing the voting live.</p>
<h3>Physical setup</h3>
<p>To make sure that the audience can appreciate the competition as much as possible you <strong>must</strong> provide some way for the audience to follow allow with what the participants are doing. We ended up with one monitor for each participant where they mirrored their screen like you see on the image above. This made sure that everyone could see everything during the entire heat but also when it was finished and voting was taking place. I&#x27;ve seen some other setups where each heat had more participants and instead of doing monitors for each they opted for larger screens that cycled through all the different players. Regardless of which you choose make sure to proved power and monitor adapters for everyone, as well as <em>&quot;normal&quot;</em> event stuff like food, snacks, drinks (non-alcoholic is always a good idea). We ended up buying about 100 cheeseburgers from the closest fast-food restaurant and that was a success ðŸŽ‰</p>
<h3>Setting the mood</h3>
<p>Code in the Dark is a competition just as much for the audience as for the participants. This makes it extra important to try and create an awesome <em>mood</em> that encourages people to stay and watch. For me that means two major things, great music, and great lighting. I was lucky enough to have some RGB party lights that could react to sound at the office, which combined with some great music choices by my colleague Filip (<a href="https://open.spotify.com/artist/7eOzCiTklgHxfpf6Mb3D2e?si=ZrwMCOX5SAqlaoeIJuKUMw">Mitch Murder</a>, <a href="https://open.spotify.com/artist/1xvEo98zythSrgN69GQevk?si=Zv2bKdJ6SmKU5YSKQchd2A">FM 84</a>, <a href="https://open.spotify.com/artist/0UF7XLthtbSF2Eur7559oV?si=cD55U4iNTTWWeYh_HoB9rQ">Kavinsky</a>, etc) made for an <a href="https://www.youtube.com/watch?v=fQGbXmkSArs">epic feeling</a>. And if you want to take it to the next level, I can&#x27;t recommend getting your hands on a smoke machine, some fancy light show lasers and some glowsticks enough. For us, it felt like it turned a great event into a fantastic event.</p>
<h2>Checklist</h2>
<p>Finally, here&#x27;s a checklist I used in the preparations in case it helps you in hosting your own Code in the Dark event.</p>
<ul>
<li>Create reference images</li>
<li>Prepare editors with images and assets</li>
<li>Power adapters</li>
<li>Monitors</li>
<li>Adapters for monitors (HDMI to X)</li>
<li>Prepare a presentation with timer and voting instructions</li>
<li>Monitor for the presentation (timer, voting etc)</li>
<li>Prepare voting (ex Mentimeter)</li>
<li>Food</li>
<li>Drinks</li>
<li>Snacks</li>
<li>Prize</li>
<li>Music</li>
<li>Smoke machine</li>
<li>Lights</li>
<li>Glowsticks</li>
<li>Light show lasers</li>
</ul>
<p>If you&#x27;ve ever hosted a similar event I&#x27;d love to hear what you did differently, what worked and what didn&#x27;t.
And please let me know if you host a similar event in the future, I&#x27;d love to see some pictures!</p>
<p>Thanks for reading!</p>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Compound components in React]]></title>
        <id>https://antongunnarsson.com/posts/compound-components-in-react</id>
        <link href="https://antongunnarsson.com/posts/compound-components-in-react"/>
        <updated>2021-03-09T20:17:00.000Z</updated>
        <content type="html"><![CDATA[<p>Sometimes you find yourself in a situation where you need to build a component that is reusable but also very flexible so it can adapt to a myriad of situations. It could be something like a toggle, tabbed navigation, or an accordion. A pattern that I think is fantastic for solving these problems is <span class="Confettis__Wrapper-sc-ddece11b-0 bqssCy"><strong class="Confettis__ChildWrapper-sc-ddece11b-4 klOoqJ">compound components</strong></span>. That is when you have multiple components working together in a coupled but flexible way.</p>
<p>Let&#x27;s look at how we could build this accordion as a compound component:</p>
<div class="AccordionExample__Wrapper-sc-77930a89-0 dCeJgm"><div class="AccordionExample__Option-sc-77930a89-1 gbHCEF"><button class="AccordionExample__StyledToggle-sc-77930a89-2 fdPFHf">Item 1</button><div class="AccordionExample__Content-sc-77930a89-3 czcqYw">Hey you! I&#x27;m a <b>interactive</b> example! Try expanding the other items or closing this one!</div></div><div class="AccordionExample__Option-sc-77930a89-1 gbHCEF"><button class="AccordionExample__StyledToggle-sc-77930a89-2 fdPFHf">Item 2</button></div><div class="AccordionExample__Option-sc-77930a89-1 gbHCEF"><button class="AccordionExample__StyledToggle-sc-77930a89-2 fdPFHf">Item 3</button></div></div>
<p>This accordion consists of three components: One for the toggling button, one for the collapsible content, and one parent that ties everything together. Here&#x27;s how it looks when using it:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#800000">&lt;</span><span style="color:#267F99">Accordion</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#800000">&lt;div&gt;</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Accordion.Toggle</span><span style="color:#000000"> </span><span style="color:#FF0000">eventKey</span><span style="color:#000000">=</span><span style="color:#A31515">&quot;item1&quot;</span><span style="color:#800000">&gt;</span><span style="color:#000000">Item 1</span><span style="color:#800000">&lt;/</span><span style="color:#267F99">Accordion.Toggle</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Accordion.Content</span><span style="color:#000000"> </span><span style="color:#FF0000">eventKey</span><span style="color:#000000">=</span><span style="color:#A31515">&quot;item1&quot;</span><span style="color:#800000">&gt;</span><span style="color:#000000">Content 1...</span><span style="color:#800000">&lt;/</span><span style="color:#267F99">Accordion.Content</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#800000">&lt;/div&gt;</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#800000">&lt;div&gt;</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Accordion.Toggle</span><span style="color:#000000"> </span><span style="color:#FF0000">eventKey</span><span style="color:#000000">=</span><span style="color:#A31515">&quot;item2&quot;</span><span style="color:#800000">&gt;</span><span style="color:#000000">Item 2</span><span style="color:#800000">&lt;/</span><span style="color:#267F99">Accordion.Toggle</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Accordion.Content</span><span style="color:#000000"> </span><span style="color:#FF0000">eventKey</span><span style="color:#000000">=</span><span style="color:#A31515">&quot;item2&quot;</span><span style="color:#800000">&gt;</span><span style="color:#000000">Content 2...</span><span style="color:#800000">&lt;/</span><span style="color:#267F99">Accordion.Content</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#800000">&lt;/div&gt;</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#800000">&lt;div&gt;</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Accordion.Toggle</span><span style="color:#000000"> </span><span style="color:#FF0000">eventKey</span><span style="color:#000000">=</span><span style="color:#A31515">&quot;item3&quot;</span><span style="color:#800000">&gt;</span><span style="color:#000000">Item 3</span><span style="color:#800000">&lt;/</span><span style="color:#267F99">Accordion.Toggle</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Accordion.Content</span><span style="color:#000000"> </span><span style="color:#FF0000">eventKey</span><span style="color:#000000">=</span><span style="color:#A31515">&quot;item3&quot;</span><span style="color:#800000">&gt;</span><span style="color:#000000">Content 3...</span><span style="color:#800000">&lt;/</span><span style="color:#267F99">Accordion.Content</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#800000">&lt;/div&gt;</span></span>
<span class="line"><span style="color:#800000">&lt;/</span><span style="color:#267F99">Accordion</span><span style="color:#800000">&gt;</span></span></code></pre></div>
<p>There&#x27;s a couple of things to note here. First off <code>&lt;Accordion.Toggle&gt;</code> and <code>&lt;Accordion.Content&gt;</code> might look a little weird with it if you haven&#x27;t seen it before, but it is because the <code>&lt;Toggle&gt;</code> and <code>&lt;Content&gt;</code> components are added as static properties on <code>&lt;Accordion&gt;</code>. This is not a requirement in any way but I think it makes it clearer that we are dealing with tightly coupled components intended to be used together.</p>
<div class="Callout__Wrapper-sc-ecc76565-0 ibhdIn"><p>If you&#x27;ve ever used <a href="https://reach.tech/">Reach UI</a> or <a href="https://react-bootstrap.github.io/">React Bootstrap</a> this probably looks familiar to you. They use this pattern for accordions and other components.</p></div>
<p>Secondly neither the <code>&lt;Toggle&gt;</code> and <code>&lt;Content&gt;</code> components are direct children of <code>&lt;Accordion&gt;</code>. This is possible because we use a Context to pass data between our components, which gives us a lot of flexibility in how we want our accordion to look and work.</p>
<p>Here is how the parent component <code>&lt;Accordion&gt;</code> is implemented:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">AccordionContext</span><span style="color:#000000"> = </span><span style="color:#001080">React</span><span style="color:#000000">.</span><span style="color:#795E26">createContext</span><span style="color:#000000">()</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">Accordion</span><span style="color:#000000">({ </span><span style="color:#001080">children</span><span style="color:#000000"> }) {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> [</span><span style="color:#0070C1">activeKey</span><span style="color:#000000">, </span><span style="color:#0070C1">setActiveKey</span><span style="color:#000000">] = </span><span style="color:#795E26">useState</span><span style="color:#000000">(</span><span style="color:#0000FF">null</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">setKey</span><span style="color:#000000"> = (</span><span style="color:#001080">newKey</span><span style="color:#000000">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#AF00DB">if</span><span style="color:#000000"> (</span><span style="color:#001080">newKey</span><span style="color:#000000"> === </span><span style="color:#001080">activeKey</span><span style="color:#000000">) </span><span style="color:#795E26">setActiveKey</span><span style="color:#000000">(</span><span style="color:#0000FF">null</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#AF00DB">else</span><span style="color:#000000"> </span><span style="color:#795E26">setActiveKey</span><span style="color:#000000">(</span><span style="color:#001080">newKey</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">  }</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;</span><span style="color:#267F99">AccordionContext.Provider</span><span style="color:#000000"> </span><span style="color:#FF0000">value</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#000000FF">{ </span><span style="color:#001080">activeKey</span><span style="color:#000000FF">, </span><span style="color:#001080">setKey</span><span style="color:#000000FF"> }</span><span style="color:#0000FF">}</span><span style="color:#800000">&gt;</span><span style="color:#0000FF">{</span><span style="color:#001080">children</span><span style="color:#0000FF">}</span><span style="color:#800000">&lt;/</span><span style="color:#267F99">AccordionContext.Provider</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>There&#x27;s a bit to unpack here so let&#x27;s start at the top. We create a context called <code>AccordionContext</code> that will be used to connect our components. Then we set up some state, <code>activeKey</code>, to hold the currently open &quot;tab&quot;s key and create a function that updates our state to open/close the accordion. Lastly, we return the component&#x27;s <code>children</code> wrapped in our contexts <code>&lt;Provider&gt;</code> which value we set to an object with <code>activeKey</code> and <code>setKey</code>.</p>
<p>With that set up we can take a look at <code>&lt;Content&gt;</code> where the implementation looks like this:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">Content</span><span style="color:#000000">({ </span><span style="color:#001080">children</span><span style="color:#000000">, </span><span style="color:#001080">eventKey</span><span style="color:#000000"> }) {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> { </span><span style="color:#0070C1">activeKey</span><span style="color:#000000"> } = </span><span style="color:#795E26">useContext</span><span style="color:#000000">(</span><span style="color:#001080">AccordionContext</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">if</span><span style="color:#000000"> (</span><span style="color:#001080">activeKey</span><span style="color:#000000"> !== </span><span style="color:#001080">eventKey</span><span style="color:#000000">) </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#0000FF">null</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#001080">children</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>We get <code>activeKey</code> from the <code>AccordionContext</code> and if it doesn&#x27;t match the prop <code>eventKey</code> we return <code>null</code>, otherwise we return <code>children</code>.</p>
<p>Finally, this is how <code>&lt;Toggle&gt;</code> looks:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">Toggle</span><span style="color:#000000">({ </span><span style="color:#001080">children</span><span style="color:#000000">, </span><span style="color:#001080">eventKey</span><span style="color:#000000"> }) {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> { </span><span style="color:#0070C1">setKey</span><span style="color:#000000"> } = </span><span style="color:#795E26">useContext</span><span style="color:#000000">(</span><span style="color:#001080">AccordionContext</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;button</span><span style="color:#000000"> </span><span style="color:#FF0000">onClick</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#000000FF">() </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000FF"> </span><span style="color:#795E26">setKey</span><span style="color:#000000FF">(</span><span style="color:#001080">eventKey</span><span style="color:#000000FF">)</span><span style="color:#0000FF">}</span><span style="color:#800000">&gt;</span><span style="color:#0000FF">{</span><span style="color:#001080">children</span><span style="color:#0000FF">}</span><span style="color:#800000">&lt;/button&gt;</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>Here we grab <code>setKey</code> from our <code>AccordionContext</code> and when the user clicks the button we call it with the toggles <code>eventKey</code> as its only argument.</p>
<aside class="Extracurricular__Wrapper-sc-2a36ab9-0 gNdkVe"><button class="Extracurricular__Title-sc-2a36ab9-1 iiXLbn"><span><span style="font-weight:bold">Extracurricular: </span>Give the user more control of &lt;Toggle&gt;</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="Extracurricular__Chevron-sc-2a36ab9-2 dcgivW"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button><div class="Extracurricular__Content-sc-2a36ab9-3 FEBjz"><p>Sometimes you might want to give the user the option of what element the toggle should be and one way of adding that flexibility would be to use a <a href="https://antongunnarsson.com/render-props">render prop</a>. We could also use another pattern where you can control the element type with a prop. Usually this prop is called <code>as</code>. In our example it would look like this:</p><div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">Toggle</span><span style="color:#000000">({ </span><span style="color:#001080">children</span><span style="color:#000000">, </span><span style="color:#001080">eventKey</span><span style="color:#000000">, </span><span style="color:#001080">as</span><span style="color:#000000"> = </span><span style="color:#A31515">&#x27;button&#x27;</span><span style="color:#000000"> }) {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> { </span><span style="color:#0070C1">setKey</span><span style="color:#000000"> } = </span><span style="color:#795E26">useContext</span><span style="color:#000000">(</span><span style="color:#001080">AccordionContext</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#001080">React</span><span style="color:#000000">.</span><span style="color:#795E26">createElement</span><span style="color:#000000">(</span><span style="color:#001080">as</span><span style="color:#000000">, {</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#795E26">onClick</span><span style="color:#001080">:</span><span style="color:#000000"> () </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> </span><span style="color:#795E26">setKey</span><span style="color:#000000">(</span><span style="color:#001080">eventKey</span><span style="color:#000000">),</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#001080">children:</span><span style="color:#000000"> </span><span style="color:#001080">children</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">  })</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div><p>To achieve this we use the <a href="https://reactjs.org/docs/react-api.html#cloneelement">cloneElement</a> function from Reacts top-level API and with this, we can pass any element type to <code>Toggle</code> and it will <em>just work</em>.</p></div></aside>
<p>And with that our accordion is complete! You can find the complete implementation <a href="https://github.com/anton-g/blog/blob/master/content/blog/compound-components-in-react/components/Accordion.js">here</a>.</p>
<p>So to recap: By splitting the implementation across multiple components that share an implicit state using <code>Context</code> we&#x27;ve created a more expressive and flexible API for our accordion. If we suddenly decide we want to have the accordion buttons below the content we only need to change the usage and not the implementation. This is one of the biggest benefits of compound components.</p>
<p>Hopefully this has given you some insight into why and when compound components are useful. I think it should be a tool in every React developers toolbox.</p>
<aside class="Extracurricular__Wrapper-sc-2a36ab9-0 gNdkVe"><button class="Extracurricular__Title-sc-2a36ab9-1 iiXLbn"><span><span style="font-weight:bold">Extracurricular: </span>Compound components without React context?</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="Extracurricular__Chevron-sc-2a36ab9-2 dcgivW"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button><div class="Extracurricular__Content-sc-2a36ab9-3 FEBjz"><p>Glad you want to learn more! It is possible to create compound components without using context, with the caveat that it&#x27;s a little less flexible and a bit more complex.</p><p>Instead of connecting our components with a context we can use <code>React.cloneElement</code> to pass <code>activeKey</code> and <code>setKey</code> as props from the parent to its children:</p><div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">Accordion</span><span style="color:#000000">({ </span><span style="color:#001080">children</span><span style="color:#000000"> }) {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> [</span><span style="color:#0070C1">activeKey</span><span style="color:#000000">, </span><span style="color:#0070C1">setActiveKey</span><span style="color:#000000">] = </span><span style="color:#795E26">useState</span><span style="color:#000000">(</span><span style="color:#0000FF">null</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">setKey</span><span style="color:#000000"> = (</span><span style="color:#001080">newKey</span><span style="color:#000000">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#AF00DB">if</span><span style="color:#000000"> (</span><span style="color:#001080">newKey</span><span style="color:#000000"> === </span><span style="color:#001080">activeKey</span><span style="color:#000000">) </span><span style="color:#795E26">setActiveKey</span><span style="color:#000000">(</span><span style="color:#0000FF">null</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#AF00DB">else</span><span style="color:#000000"> </span><span style="color:#795E26">setActiveKey</span><span style="color:#000000">(</span><span style="color:#001080">newKey</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">  }</span></span>
<span class="line"> </span>
<span class="line highlighted"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#001080">React</span><span style="color:#000000">.</span><span style="color:#001080">Children</span><span style="color:#000000">.</span><span style="color:#795E26">map</span><span style="color:#000000">(</span><span style="color:#001080">children</span><span style="color:#000000">, (</span><span style="color:#001080">child</span><span style="color:#000000">) </span><span style="color:#0000FF">=&gt;</span></span>
<span class="line highlighted"><span style="color:#000000">    </span><span style="color:#001080">React</span><span style="color:#000000">.</span><span style="color:#795E26">cloneElement</span><span style="color:#000000">(</span><span style="color:#001080">child</span><span style="color:#000000">, {</span></span>
<span class="line highlighted"><span style="color:#000000">      </span><span style="color:#001080">setKey</span><span style="color:#000000">,</span></span>
<span class="line highlighted"><span style="color:#000000">      </span><span style="color:#001080">activeKey</span><span style="color:#000000">,</span></span>
<span class="line highlighted"><span style="color:#000000">    })</span></span>
<span class="line highlighted"><span style="color:#000000">  )</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div><p>This works but with the big caveat that it requires <code>&lt;Toggle&gt;</code> and <code>&lt;Content&gt;</code> to be direct children of <code>&lt;Accordion&gt;</code>, and with that we lose the flexibility to structure our markup however we want.</p><p>Another drawback is that we now pass both <code>activeKey</code> and <code>setKey</code> to <strong>all</strong> children. We could work around this by checking the type of <code>child</code> before cloning it but this also increases the complexity of our implementation and for no apparent benefit.</p><p>So while it is possible to create compound components without a context there is little to no benefit to doing so if Context is an alternative.</p></div></aside>
<p>You&#x27;re more than welcome to hit me up on <a href="https://twitter.com/awnton">Twitter</a> if you have any suggestions or feedback!</p>
<p>Thanks for reading!</p>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Digital Garden]]></title>
        <id>https://antongunnarsson.com/posts/digital-garden</id>
        <link href="https://antongunnarsson.com/posts/digital-garden"/>
        <updated>2020-08-12T21:05:00.000Z</updated>
        <content type="html"><![CDATA[<p>I really like writing things here, but I usually put to much pressure on myself about the quality, length and how interesting the content has to be. This have led to me writing much less than I&#x27;d like, so the last couple of months I&#x27;ve been thinking about how to fix that and I&#x27;ve settled on using the idea of a <em>digital garden</em>.</p>
<p>What is a digital garden? Joel Hooks have a great <a href="https://joelhooks.com/digital-garden">post</a> on it, where he describes it like this:</p>
<blockquote>
<p>The phrase &quot;digital garden&quot; is a metaphor for thinking about writing and creating that focuses less on the resulting &quot;showpiece&quot; and more on the process, care, and craft it takes to get there.</p>
</blockquote>
<p>So this post is the first where I try this. Publishing without considering it done. Dropping the idea that it has to be interesting. Just writing.</p>
<p>A very incomplete list of things that I&#x27;d like to implement or try out while doing this rebuild:</p>
<ul>
<li>Tag posts</li>
<li>Post search</li>
</ul>
<p>And some reading and inspiration while we&#x27;re at it:</p>
<ul>
<li><a href="https://tomcritchlow.com/2019/02/17/building-digital-garden/">https://tomcritchlow.com/2019/02/17/building-digital-garden/</a></li>
<li><a href="https://stackingthebricks.com/how-blogs-broke-the-web/">https://stackingthebricks.com/how-blogs-broke-the-web/</a></li>
<li><a href="https://www.swyx.io/writing/digital-garden-tos/">https://www.swyx.io/writing/digital-garden-tos/</a></li>
<li><a href="https://maggieappleton.com/metatour">https://maggieappleton.com/metatour</a></li>
<li><a href="https://matthiasott.com/articles/into-the-personal-website-verse">https://matthiasott.com/articles/into-the-personal-website-verse</a></li>
<li><a href="https://www.christopherbiscardi.com/what-is-a-digital-garden">https://www.christopherbiscardi.com/what-is-a-digital-garden</a></li>
</ul>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Front-end terminology]]></title>
        <id>https://antongunnarsson.com/posts/frontend-terminology</id>
        <link href="https://antongunnarsson.com/posts/frontend-terminology"/>
        <updated>2020-09-25T17:33:00.000Z</updated>
        <content type="html"><![CDATA[<p>A very unsorted and incomplete list of terminology, phrases and products you might run into when working with front-end development. Don&#x27;t use this as a list of things to study, but rather as list to skim through from time to time to try and pick up something. Again, you <em>don&#x27;t</em> have to know all of this.</p>
<ul>
<li><strong>DevTools</strong><br/>
Short for developer tools. Usually refers to the developer tools of browsers like <a href="https://developer.mozilla.org/sv-SE/docs/Tools">Firefox</a> or <a href="https://developers.google.com/web/tools/chrome-devtools">Chrome</a>, but could also refer to devtool extensions for frameworks (<a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi">React</a>, <a href="https://chrome.google.com/webstore/detail/vuejs-devtools/nhdogjmejiglipccpnnnanhbledajbpd">Vue</a>).</li>
<li><strong>URL</strong> <em>(Uniform Resource Locator)</em>
Same thing as a web address, for example &quot;<em>https://antongunnarsson.com</em>&quot;.</li>
<li><strong>Copy</strong><br/>
The text on a web page. Originally from <a href="https://en.wikipedia.org/wiki/Copywriting">copywriting</a> but now often used as a generic word for all texts.</li>
<li><strong>White space</strong><br/>
The empty space between elements on a page, although not necessarily white.</li>
<li><strong>Accessibility</strong> <em>(a11y)</em><br/>
Best practices for keeping a website accessible for people with any kind of disability. The acronym comes from the fact that there is 11 letters between <em>a</em> and <em>y</em> in accessibility.</li>
<li><strong>Internationalization</strong> <em>(i18n)</em><br/>
Best practices for enabling a site to be adapted to any culture (language etc). The acronym comes from the fact that there is 18 letters between <em>i</em> and <em>n</em> in internationalization.</li>
<li><strong>Localization</strong> <em>(l10n)</em><br/>
The act of adapting a site to a specific culture. For example translating texts, formatting numbers etc. The acronym comes from the fact that there is 10 letters between <em>l</em> and <em>n</em> in localization.</li>
<li><strong>Client side</strong><br/>
Code run on the <em>client</em>, for example in a users browser.</li>
<li><strong>Server side</strong><br/>
Code run on a <em>server</em>.</li>
<li><strong>Environment variable</strong><br/>
Variables set on the enviroment in which the &quot;app&quot; is deployed.</li>
<li><strong>CSS</strong><br/>
Language for controlling how web pages are <em>displayed</em>.</li>
<li><strong>CSS preprocessor</strong><br/>
A way to write CSS but with more features, for example nesting, by utilizing a different syntax. Needs a build step to be transformed into CSS. Examples: <a href="https://sass-lang.com/">Sass</a>, <a href="http://lesscss.org/">Less</a>.</li>
<li><strong>CSS-in-JS</strong><br/>
A category of tools that allow you to write CSS inside of your JavaScript. Benefits include easier ways to applying styling based on state and reducing scoping issues. Examples: <a href="https://styled-components.com/">styled-components</a>, <a href="https://emotion.sh/">emotion</a>.</li>
<li><strong>CSS modules</strong><br/>
A way to write CSS where it&#x27;s scoped locally by default. Solves similar issues as CSS-in-JS. <a href="https://github.com/css-modules/css-modules">Read more</a>.</li>
<li><strong>HTML</strong><br/>
HyperText Markup Language. The standard way to specify a websites <em>structure</em>.</li>
<li><strong>HTML Tag</strong><br/>
A tag specifies the start and end of an HTML element. For example <code>&lt;tagstart&gt;content&lt;/tagend&gt;</code>.</li>
<li><strong>Meta tag</strong><br/>
Meta tags are special HTML tags that are used to convey metadata information that is used by things like search engines, website embeds and other.</li>
<li><strong>Wrapping</strong><br/>
The act of adding <em>something</em> around <em>something</em>. For example, &quot;You need to wrap the content variable in curly brackets&quot; would mean to go from <code>content</code> to <code>{content}</code>.</li>
<li><strong>Nesting</strong></li>
<li>Semantics (eg semantic HTML)</li>
<li><strong>User Agent</strong><br/>
A string indicating what web browser that is used.</li>
<li><strong>JavaScript</strong><br/>
A programming language. Originally only used for building interactive websites but nowadays used in a myriad of different contexts, for example on desktops with <a href="">NodeJS</a>. Gets a lot of hate for being &quot;bad&quot; but is actually pretty great.</li>
<li><strong>TypeScript</strong><br/>
A programming language that builds on top of <a href="">JavaScript</a> by adding static type definitions which provide a way to tell the computer what <em>type</em> of value a variable should be. Arguably makes the code more verbose but less prone to bugs.</li>
<li><strong>CMS</strong><br/>
Content Management System. A system that helps users manage the content of a website, for example <a href="https://wordpress.com/">Wordpress</a> or <a href="https://www.contentful.com/">Contentful</a>.</li>
<li><strong>SEO</strong><br/>
Search Engine Optimization. Practices for optimizing a websites ranking in search engines such as Google. Mostly guess-work since Google et al won&#x27;t describe how they work.</li>
<li><strong>CRUD</strong><br/>
Short for <strong>C</strong>reate, <strong>R</strong>ead, <strong>U</strong>pdate, <strong>D</strong>elete. Used to describe the basic operations of persistent storage. Sometimes also refers to simple websites where all you can do is these actions.</li>
<li><strong>DOM</strong><br/>
Short for Document Object Model. Interface that represents a document tree, for example an HTML document. Enables updating the document with a language such as <a href="">JavaScript</a>.</li>
<li><strong>Virtual DOM</strong><br/>
An abstraction of the DOM that aims to solve performance issues of large amounts of DOM updates by keeping track of what elements (etc) is changed <em>outside of the DOM</em>. Popularized by <a href="">React</a>.</li>
<li><strong>Shadow DOM</strong><br/>
Browser technology that tries to solve issues with scoping variables and CSS in the context of <a href="">Web Components</a>.</li>
<li><strong>UI</strong><br/>
User Interface. All the things you see on a web page.</li>
<li><strong>UX</strong> <em>(User Experience)</em><br/>
How users interact with a web site but also how the web site affects user. For example the color <code>red</code> might indicate a dangerous action while the color <code>green</code> could indicate something positive.</li>
<li><strong>CTA</strong> <em>(Call To Action)</em><br/>
Part of a user interface that encourages the user to take some action, usually a button in a primary color.</li>
<li>CI/CD <em>(Continuous Integration / Continuous Delivery)</em></li>
<li><strong>Version Control</strong><br/>
The act of saving multiple versions of things you work on. For example copying your school projects and naming then &quot;project.docx&quot;, &quot;project-v2.docx&quot;, &quot;project-v2-final.docx&quot;. In programming you usually use a tool such as <a href="https://antongunnarsson.com/posts/frontend-terminology#">Git</a> to handle this for you.</li>
<li><strong>Git</strong><br/>
The most popular version control system, despite it being very easy to screw up with it. My greatest tip: <a href="https://ohshitgit.com">Oh Shit, Git?!</a>.</li>
<li><strong>GitHub.com</strong><br/>
The most popular platform for hosting <a href="https://antongunnarsson.com/posts/frontend-terminology#">Git</a> repositories and the de-facto standard for open source. Other popular platforms is <a href="https://gitlab.com/">GitLab</a> and <a href="https://bitbucket.org/">Bitbucket</a>.</li>
<li>Branch (version control)</li>
<li>Repository (version control)</li>
<li>Pull request</li>
<li><strong>Merge request</strong><br/>
See <a href="">pull requeast</a></li>
<li><strong>&quot;Above the fold&quot;</strong><br/>
Content shown on the screen when intially loading a webpage. The fold referencing the bottom of the screen. <em>The term originates from newspapers where content on the top half of a folded newspaper was used to grab peoples attention</em>.</li>
<li><strong>&quot;Hard coded&quot;</strong><br/>
Values typed directly into the code, and hence not dynamic.</li>
<li>Backend</li>
<li><strong>Frontend</strong><br/>
What the user interacts with. In the context of web sites it&#x27;s 99% of the time <a href="https://antongunnarsson.com/posts/frontend-terminology#">HTML</a>, <a href="https://antongunnarsson.com/posts/frontend-terminology#">CSS</a> and <a href="https://antongunnarsson.com/posts/frontend-terminology#">JavaScript</a>.</li>
<li><strong>Full stack</strong><br/>
A very _ term used to describe working with both the <a href="https://antongunnarsson.com/posts/frontend-terminology#">Frontend</a> and <a href="https://antongunnarsson.com/posts/frontend-terminology#">Backend</a>.</li>
<li><strong>404</strong><br/>
Error code for page not found</li>
<li><strong>500</strong>
Error code for &quot;internal server error&quot;, ie when something went wrong on the <a href="">server</a>.</li>
<li><strong>Bug</strong><br/>
An error, a flaw, a fault. Something that doesn&#x27;t work. The worlds first computer bug is reported to have been an <a href="https://www.nationalgeographic.org/thisday/sep9/worlds-first-computer-bug/">actual bug</a>.</li>
<li><strong>Debugging</strong><br/>
Removing bugs from a program. Usually time is mostly spent investigating what the bug actually is, rather than writing code to fix it. Or as <em>someone</em> once said: &quot;Debugging is like being the detective in a crime story where you are also the murderer.&quot;</li>
<li><strong>Cache</strong><br/>
Short term storage of data. Often used to store data that is heavy to calculate and doesn&#x27;t need to be recalculated every time it&#x27;s fetched.</li>
<li>Cookies</li>
<li>API</li>
<li>REST</li>
<li>GraphQL</li>
<li>DevOps</li>
<li>Responsive design</li>
<li><strong>Sitemap</strong><br/>
A document used by search engine bots to find all the pages on your site.</li>
<li>robots.txt</li>
<li><strong>Wireframe</strong><br/>
A very rough design, usually just outlines and aproximated position of elements. Similar to mockup.</li>
<li>Framework</li>
<li>Library</li>
<li><strong>React</strong><br/>
One of the largest and most popular JavaScript frameworks. Created by Facebook. Introduced the idea of declarative components to the masses. Uses <a href="https://antongunnarsson.com/posts/frontend-terminology#">JSX</a>.</li>
<li>JSX</li>
<li>Vue
<ul>
<li>SFC</li>
</ul>
</li>
<li>Angular</li>
<li>Svelte</li>
<li>Web components</li>
<li>State management</li>
<li>Minification</li>
<li>MVP</li>
<li>IDE</li>
<li>WebStorm</li>
<li>Text editor</li>
<li><strong>VS Code</strong><br/>
One of the most popular text editors used for code. Created by Microsoft.</li>
<li>Atom</li>
<li>Sublime</li>
<li>Agile / Scrum</li>
<li>The Cloud</li>
<li>Azure</li>
<li>AWS</li>
<li>Google Cloud Platform</li>
<li>CLI</li>
<li>NodeJS</li>
<li>StackOverflow</li>
<li>EcmaScript <em>(ES5/ES6/ES7..)</em></li>
<li>Package manager
<ul>
<li>NPM</li>
<li>Yarn</li>
</ul>
</li>
<li>Package registry</li>
<li>Webpack</li>
<li>Linting
<ul>
<li>Prettier</li>
<li>ESLint</li>
</ul>
</li>
<li>Static site generators (SSG)</li>
<li>Media query</li>
<li>Recursion<br/>
See <a href="">recursion</a></li>
<li>Native apps</li>
</ul>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[A functional javascript sandwich]]></title>
        <id>https://antongunnarsson.com/posts/functional-sandwich</id>
        <link href="https://antongunnarsson.com/posts/functional-sandwich"/>
        <updated>2018-09-17T21:05:00.000Z</updated>
        <content type="html"><![CDATA[<p>A while ago I held a lightning talk about functional programming in javascript, and demonstrated it by using the array functions <code>map</code>, <code>filter</code> and <code>reduce</code> to create a <em>tasty sandwich</em>. This post is the written version of that talk, but with a little more background about functional programming. But what is functional programming more exactly? My first hit on Google for <em>&quot;what is functional programming&quot;</em> is <a href="https://medium.com/javascript-scene/master-the-javascript-interview-what-is-functional-programming-7f218c68b3a0">this post</a> by Eric Elliot. In it he says this:</p>
<blockquote>
<p><strong>Functional programming</strong> (often abbreviated FP) is the process of building software by composing <strong>pure functions</strong>, avoiding <strong>shared state</strong>, <strong>mutable</strong> data and <strong>side-effects</strong>.</p>
</blockquote>
<p>Let&#x27;s take some time to explain these terms before we start making our sandwich.</p>
<h3>Pure functions</h3>
<p>A pure function is a function that given the same input always returns the same output, and has no side effects.
A very basic example of a pure function:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="javascript" data-theme="default"><span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">add</span><span style="color:#000000"> = (</span><span style="color:#001080">x</span><span style="color:#000000">, </span><span style="color:#001080">y</span><span style="color:#000000">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> </span><span style="color:#001080">x</span><span style="color:#000000"> + </span><span style="color:#001080">y</span></span></code></pre></div>
<p>This function has two parameters that are added together with the plus operator. No matter how many times we call this function with the same arguments, it will always return the same output.</p>
<p>An unpure function could look like this:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="javascript" data-theme="default"><span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">z</span><span style="color:#000000"> = </span><span style="color:#098658">5</span></span>
<span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">add</span><span style="color:#000000"> = (</span><span style="color:#001080">x</span><span style="color:#000000">, </span><span style="color:#001080">y</span><span style="color:#000000">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> </span><span style="color:#001080">x</span><span style="color:#000000"> + </span><span style="color:#001080">y</span><span style="color:#000000"> + </span><span style="color:#001080">z</span></span></code></pre></div>
<p>This function depends on state that is shared between scopes, which means that if we change the variable <code>z</code> but not the arguments we pass to the function the output will change and hence the function is unpure.</p>
<h3>Side effects</h3>
<p>Side effects are when a function interacts with something outside it&#x27;s scope. This could be anything from printing something to the console to modifying a variable outside the function.</p>
<p>Some examples of side effects are:</p>
<ul>
<li>Modifying any external variable</li>
<li>console.log()</li>
<li>Making a HTTP request</li>
<li>Updating the DOM</li>
<li>Calling any other function with side effects</li>
</ul>
<p>This also makes it obvious that not every function can be pure, and <strong>that is fine</strong>. The benefit of writing pure functions is that they are very easily testable and makes it safer to refactor code since you know that this function won&#x27;t have any unintended side effects.</p>
<h3>Mutable data</h3>
<p>A mutable variable is a variable which value can be changed after it&#x27;s been created. Mutable variables can make it hard to reason about our code since we can&#x27;t be sure what the variables value is when we use it. On the other hand, an <strong>immutable</strong> variable is a variable that can&#x27;t be changed after creating it.</p>
<p>In my opinion the biggest benefit of striving for immutability is that it increases the predictability of our code since <a href="https://medium.com/javascript-scene/the-dao-of-immutability-9f91a70c88cd">mutation hides change</a>. This means we can reason about our code easier, debug it faster and keep the mental overhead small.</p>
<p>It&#x27;s important to remember that, in javascript, variables declared with <code>const</code> are <strong>not immutable</strong>. It only prevents you from reassigning and redeclaring the variable. This would work:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="javascript" data-theme="default"><span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">person</span><span style="color:#000000"> = {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#001080">name:</span><span style="color:#000000"> </span><span style="color:#A31515">&#x27;Anton&#x27;</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">}</span></span>
<span class="line"><span style="color:#001080">person</span><span style="color:#000000">.</span><span style="color:#001080">name</span><span style="color:#000000"> = </span><span style="color:#A31515">&#x27;Alfredo&#x27;</span></span></code></pre></div>
<p>To prevent this from working we could use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze">Object.freeze()</a> to freeze the object which will prevent setting the value of name (and throw an error if running in <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode">strict mode</a>).</p>
<h3>Shared state</h3>
<p>Shared state is variables or other state that is shared between between different scopes. For example a functions local scope and the global scope. In functional programming we try to avoid shared state and instead rely on our immutable data structures and the possibility to obtain new data from the existing data.</p>
<p>We&#x27;ve already seen an example of shared state in the unpure function example above. Let&#x27;s revisit it:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="javascript" data-theme="default"><span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">z</span><span style="color:#000000"> = </span><span style="color:#098658">5</span></span>
<span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">add</span><span style="color:#000000"> = (</span><span style="color:#001080">x</span><span style="color:#000000">, </span><span style="color:#001080">y</span><span style="color:#000000">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> </span><span style="color:#001080">x</span><span style="color:#000000"> + </span><span style="color:#001080">y</span><span style="color:#000000"> + </span><span style="color:#001080">z</span></span></code></pre></div>
<p>In this example <code>z</code> is shared by the global scope and the local scope of the function <code>add</code>. If we change the value of <code>z</code> it will affect both the global scope and the value inside of <code>add</code>s scope.</p>
<p>There is a lot more nitty gritty details to each of these terms and you could easily stumble down a rabbit hole of mathematical definitions, but if you want to read more the <a href="https://medium.com/javascript-scene/master-the-javascript-interview-what-is-functional-programming-7f218c68b3a0">previously mentioned article</a> is an excellent starting point.</p>
<h2>Making a sandwich</h2>
<p>Phew! With that out of the way, let&#x27;s make a sandwich! To get started we need some ingredients, and in the name of this tutorial it will only be the toppings, and only toppings that we can slice.</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="javascript" data-theme="default"><span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">ingredients</span><span style="color:#000000"> = [</span><span style="color:#A31515">&#x27;cucumber&#x27;</span><span style="color:#000000">, </span><span style="color:#A31515">&#x27;tomato&#x27;</span><span style="color:#000000">, </span><span style="color:#A31515">&#x27;sallad&#x27;</span><span style="color:#000000">]</span></span></code></pre></div>
<p>The first step in making our sandwich is to slice our ingredients, which in other words mean we <em>transform</em> the ingredients to sliced ingredients. To transform the elements of our ingredients-array we will use a function called <code>map</code>.</p>
<p><code>map</code> takes one single argument which is a callback function that will be called on every element of the array. The return value of the callback function will be the new value of the element if the new array. We start by creating a function <code>slice</code> that takes a single ingredient and transforms it to a sliced ingredient. We then pass this function as the callback to <code>map</code>:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="javascript" data-theme="default"><span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">ingredients</span><span style="color:#000000"> = [</span><span style="color:#A31515">&#x27;cucumber&#x27;</span><span style="color:#000000">, </span><span style="color:#A31515">&#x27;tomato&#x27;</span><span style="color:#000000">, </span><span style="color:#A31515">&#x27;sallad&#x27;</span><span style="color:#000000">]</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">slice</span><span style="color:#000000"> = (</span><span style="color:#001080">ingredient</span><span style="color:#000000">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#A31515">`sliced </span><span style="color:#0000FF">${</span><span style="color:#001080">ingredient</span><span style="color:#0000FF">}</span><span style="color:#A31515">`</span></span>
<span class="line"><span style="color:#000000">}</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">result</span><span style="color:#000000"> = </span><span style="color:#001080">ingredients</span><span style="color:#000000">.</span><span style="color:#795E26">map</span><span style="color:#000000">(</span><span style="color:#001080">slice</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#001080">console</span><span style="color:#000000">.</span><span style="color:#795E26">log</span><span style="color:#000000">(</span><span style="color:#001080">result</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#008000">// output: [&#x27;sliced cucumber&#x27;, &#x27;sliced tomato&#x27;, &#x27;sliced sallad&#x27;]</span></span></code></pre></div>
<p>In this case we only use the arrays element in the callback function passed to <code>map</code>, but the function also has two optional parameters. The first one is the current index of the element and the second is the array. Remember that since <code>map</code> is a pure function it doesn&#x27;t mutate the initial array but instead creates a new one, so the array parameter will never change when you run map.</p>
<h3>Assembling the sandwich</h3>
<p>Let&#x27;s continue by assembling the sandwich with <code>reduce</code>.<br/>
It is arguably the most powerful of the sandwich making functions. It can be used to accomplish anything from <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce#Examples#Sum_all_the_values_of_an_array">summing some values</a> to <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce#Examples#Running_Promises_in_Sequence">running promises in sequence</a>.</p>
<p>The function has two parameters: A <em>callback</em> function (called <em>reducer</em>) and an <em>initial value</em>. When calling <code>reduce</code> it will enumerate (<em>&quot;loop&quot;</em>) through the elements in the array and apply the callback function to each of the elements, finally resulting in a single return value. Let&#x27;s walk through the <em>callback</em> function arguments:</p>
<ul>
<li><strong>accumulator</strong>: The first parameter is named <em>accumulator</em> because it <em>&quot;accumulates the callback&#x27;s return values&quot;</em>. This never made much sense to me as a non native english speaker until I started to think about it as the <strong>total</strong> or <strong>sum</strong> of the <code>reduce</code> call. This will contain the return value from when the previous element was processed by our callback function (or <em>initialValue</em>, see below).</li>
<li><strong>currentValue</strong>: This is the current element that is being processed by our callback.</li>
<li><strong>currentIndex</strong> (optional): The current elements index in the source array.</li>
<li><strong>array</strong> (optional): The source array. <em>(Remember that since</em> <code>reduce</code> <em>is a pure function it doesn&#x27;t change the source array, so this will not change in any way during the execution of reduce).</em></li>
</ul>
<p>The second parameter of the <em>callback</em> function is the <em>initialValue</em>. The <em>accumulator</em> is initiated with whatever value we pass to this parameter.</p>
<p>Alright, now that we know about <code>reduce</code> we can assemble our sandwich and since <code>map</code> returns an array we can <em>chain</em> the call to <code>reduce</code>, making our code more compact and legible:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="javascript" data-theme="default"><span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">ingredients</span><span style="color:#000000"> = [</span><span style="color:#A31515">&#x27;cucumber&#x27;</span><span style="color:#000000">, </span><span style="color:#A31515">&#x27;tomato&#x27;</span><span style="color:#000000">, </span><span style="color:#A31515">&#x27;sallad&#x27;</span><span style="color:#000000">]</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">slice</span><span style="color:#000000"> = (</span><span style="color:#001080">ingredient</span><span style="color:#000000">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#A31515">`sliced </span><span style="color:#0000FF">${</span><span style="color:#001080">ingredient</span><span style="color:#0000FF">}</span><span style="color:#A31515">`</span></span>
<span class="line"><span style="color:#000000">}</span></span>
<span class="line"> </span>
<span class="line highlighted"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">reducer</span><span style="color:#000000"> = (</span><span style="color:#001080">total</span><span style="color:#000000">, </span><span style="color:#001080">current</span><span style="color:#000000">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line highlighted"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#A31515">`</span><span style="color:#0000FF">${</span><span style="color:#001080">total</span><span style="color:#0000FF">}</span><span style="color:#A31515">, </span><span style="color:#0000FF">${</span><span style="color:#001080">current</span><span style="color:#0000FF">}</span><span style="color:#A31515">`</span></span>
<span class="line highlighted"><span style="color:#000000">}</span></span>
<span class="line"> </span>
<span class="line highlighted"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">result</span><span style="color:#000000"> = </span><span style="color:#001080">ingredients</span><span style="color:#000000">.</span><span style="color:#795E26">map</span><span style="color:#000000">(</span><span style="color:#001080">slice</span><span style="color:#000000">).</span><span style="color:#795E26">reduce</span><span style="color:#000000">(</span><span style="color:#001080">reducer</span><span style="color:#000000">, </span><span style="color:#A31515">&#x27;A tasty sandwich with&#x27;</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#001080">console</span><span style="color:#000000">.</span><span style="color:#795E26">log</span><span style="color:#000000">(</span><span style="color:#001080">result</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#008000">// output: &#x27;A tasty sandwich with, sliced cucumber, sliced tomato, sliced sallad</span></span></code></pre></div>
<p>Above we call the <code>reduce</code> function with out callback function <code>reducer</code> which returns the <code>total</code> (the <em>accumulator</em>) concatenated with the <code>current</code> value. This will give us a string representing our sandwich containing the <em>intialValue</em> (<em>&quot;A tasty sandwich with&quot;</em>) and each of our sliced ingredients. The output looks a little malformated and we could fix this by utilizing the <em>index</em> and <em>array</em> parameters of the callback function to remove unneccesary commas etc, but for the case of simplicity let&#x27;s leave it like this for now.</p>
<h3>I&#x27;m allergic to tomatoes :(</h3>
<p>But what if we are allergic to tomatoes? Let&#x27;s remove it with <code>filter</code>.</p>
<p><code>filter</code> takes a single argument that is a callback function (just like <code>map</code>), and the callback function has three parameters (the element, the index and the array). The return value of the callback must be a bool indicating whether or not the current element should be included in the new array. In our case this means that we check if the current ingredient isn&#x27;t tomato and in this case we return true.</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="javascript" data-theme="default"><span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">ingredients</span><span style="color:#000000"> = [</span><span style="color:#A31515">&#x27;cucumber&#x27;</span><span style="color:#000000">, </span><span style="color:#A31515">&#x27;tomato&#x27;</span><span style="color:#000000">, </span><span style="color:#A31515">&#x27;sallad&#x27;</span><span style="color:#000000">]</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">slice</span><span style="color:#000000"> = (</span><span style="color:#001080">ingredient</span><span style="color:#000000">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#A31515">`sliced </span><span style="color:#0000FF">${</span><span style="color:#001080">ingredient</span><span style="color:#0000FF">}</span><span style="color:#A31515">`</span></span>
<span class="line"><span style="color:#000000">}</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">reducer</span><span style="color:#000000"> = (</span><span style="color:#001080">total</span><span style="color:#000000">, </span><span style="color:#001080">current</span><span style="color:#000000">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#A31515">`</span><span style="color:#0000FF">${</span><span style="color:#001080">total</span><span style="color:#0000FF">}</span><span style="color:#A31515">, </span><span style="color:#0000FF">${</span><span style="color:#001080">current</span><span style="color:#0000FF">}</span><span style="color:#A31515">`</span></span>
<span class="line"><span style="color:#000000">}</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">result</span><span style="color:#000000"> = </span><span style="color:#001080">ingredients</span></span>
<span class="line highlighted"><span style="color:#000000">                    .</span><span style="color:#795E26">filter</span><span style="color:#000000">(</span><span style="color:#001080">ingredient</span><span style="color:#000000"> </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line highlighted"><span style="color:#000000">                      </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#001080">ingredient</span><span style="color:#000000"> !== </span><span style="color:#A31515">&#x27;tomato&#x27;</span><span style="color:#000000">)</span></span>
<span class="line highlighted"><span style="color:#000000">                    }</span></span>
<span class="line"><span style="color:#000000">                    .</span><span style="color:#795E26">map</span><span style="color:#000000">(</span><span style="color:#001080">slice</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">                    .</span><span style="color:#795E26">reduce</span><span style="color:#000000">(</span><span style="color:#001080">reducer</span><span style="color:#000000">, </span><span style="color:#A31515">&#x27;A tasty sandwich with&#x27;</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#001080">console</span><span style="color:#000000">.</span><span style="color:#795E26">log</span><span style="color:#000000">(</span><span style="color:#001080">result</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#008000">// output: &#x27;A tasty sandwich with, sliced cucumber, sliced sallad</span></span></code></pre></div>
<p>In this case I also chose to inline the callback function in the <code>filter</code> call but this is mostly a matter of preference.</p>
<p>And <strong>that&#x27;s it</strong>! We&#x27;ve made a <em>&quot;sandwich&quot;</em> with functional javascript!</p>
<h3>ðŸŽ‰</h3>
<p>This is a really contrived example that doesn&#x27;t really demonstrate the power of these functions, but hopefully it gave you some insight into the world of functional javascript. Just remember that you don&#x27;t have to care about <strong>pure functions</strong>, <strong>immutability</strong> or any other confusing term to start benefiting from <code>map</code>, <code>reduce</code> and <code>filter</code>.</p>
<p>You just have to use them.</p>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[git switch and restore]]></title>
        <id>https://antongunnarsson.com/posts/git-switch-and-restore</id>
        <link href="https://antongunnarsson.com/posts/git-switch-and-restore"/>
        <updated>2019-11-10T21:00:00.000Z</updated>
        <content type="html"><![CDATA[<p>Git is getting easier with two new experimental commands, <code>git switch</code> and <code>git restore</code>, that were introduced in Git 2.23. They are basically <code>git checkout</code> split up into two, one for changing branches and another for changing files. Let&#x27;s start by taking a look at how we work with branches today and how it changes with switch.</p>
<h3>git switch</h3>
<p>To change to an existing branch today we use <code>git checkout [branch-name]</code> or if we pass the <code>--branch</code> flag we can create the branch at the same time (<code>git checkout --branch [branch-name]</code>).</p>
<p>With <code>git switch</code> the process is very similar, to change branch we pass it the branch name:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="shell" data-theme="default"><span class="line"><span style="color:#000000">âžœ git switch another-branch</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">Switched to branch </span><span style="color:#A31515">&#x27;another-branch&#x27;</span></span></code></pre></div>
<p>And if we want to create a new branch and change to it, we can pass the <code>--create</code> flag (or <code>-c</code>):</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="shell" data-theme="default"><span class="line"><span style="color:#000000">âžœ git switch -c new-feature</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">Switched to a new branch </span><span style="color:#A31515">&#x27;new-feature&#x27;</span></span></code></pre></div>
<p>You can find more examples and things like creating a new branch from a specific commit in the <a href="https://git-scm.com/docs/git-switch">documentation</a>.</p>
<h3>git restore</h3>
<p>The other thing we often use <code>git checkout</code> for is restoring files to it&#x27;s &quot;unchanged&quot; state (resetting the working copy to how it looks in the repository).</p>
<div class="Callout__Wrapper-sc-ecc76565-0 ibhdIn"><p>The <strong>working copy</strong> refers to a local copy of the repository, that is the files on your hard drive.</p></div>
<p>I&#x27;ve never completely grasped the intricities of checkout for restoring files, but with <code>git restore</code> it becomes much easier. To restore a file that you have changed but not yet <code>git add</code>ed you do this:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="shell" data-theme="default"><span class="line"><span style="color:#000000">âžœ git restore file.js</span></span></code></pre></div>
<p>If you have already run <code>git add</code> and the file is in the <em>index</em> you can restore it by passing the <code>--staged</code> flag:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="shell" data-theme="default"><span class="line"><span style="color:#000000">git restore --staged file.js</span></span></code></pre></div>
<div class="Callout__Wrapper-sc-ecc76565-0 ibhdIn"><p>The <strong>index</strong> (or staging area) contains the changes that have been <code>git add</code>ed, i.e. the files that would with committed by <code>git commit</code>.</p></div>
<p>Finally, we can also specify where we want to restore <em>from</em>. By default this is the <em>index</em> but by passing the <code>--source</code> flag we can adjust it. For example we can restore the index to a revision a couple of commits back:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="shell" data-theme="default"><span class="line"><span style="color:#000000">git restore --source HEAD~2 --staged file.js</span></span></code></pre></div>
<p>Like <code>switch</code> there are a lot more examples in the <a href="https://git-scm.com/docs/git-restore">documentation</a>.</p>
<h3>Summary</h3>
<p><code>switch</code> and <code>restore</code> are two new experimental commands that hopefully will make it easier to work with git from the command line. <code>switch</code> for changing branches and <code>restore</code> to change files.</p>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Mob programming for a year]]></title>
        <id>https://antongunnarsson.com/posts/mob-1-year</id>
        <link href="https://antongunnarsson.com/posts/mob-1-year"/>
        <updated>2020-03-02T21:30:00.000Z</updated>
        <content type="html"><![CDATA[<p>Last week marked the day when I&#x27;ve been mob programming full time for a whole year. In case you don&#x27;t know what mob programming is, <em>Woody Zuill</em>, who is credited for discovering the method describes it like this:</p>
<blockquote>
<p>&quot;All the brilliant people working on the same thing, at the same time, in the same place, and on the same computer.&quot;</p>
</blockquote>
<p>In short, it means that you sit together with 2 or more developers and work together on one computer, in a similar fashion to pair programming but with more people. This might sound counterproductive but in reality, it&#x27;s a very effective way of working. If you want to learn more about the why and the how of mob programming I recommend watching Woody&#x27;s <a href="https://www.youtube.com/watch?v=SHOVVnRB4h0">talk from GOTO conf 2017</a>.</p>
<p>I&#x27;ve really enjoyed discovering mob programming this past year so I wanted to write down some of my key takeaways.</p>
<h2>Processes</h2>
<p>When you work as closely with your team as you do when you mob program, it turns out that lots of processes are unnecessary.</p>
<ul>
<li>No pull requests or code reviews since that is done <em>&quot;live&quot;</em> during the day.</li>
<li>We very rarely work in feature branches since the mobs most often don&#x27;t work in the same part of the application at the same time.</li>
<li>The daily sync meeting is mostly for the benefit of product owners who wants to know how we&#x27;re doing since everyone in the team is on the same page already.</li>
</ul>
<p>When mob programming, all of these feel more like bloat and obstacles in the way of delivering value. I dread the day I&#x27;ll have to go back to attending unnecessary meetings just because someone needs to <em>&quot;talk something through&quot;</em>.</p>
<h2>My best code</h2>
<p>I&#x27;m quite certain that I&#x27;ve written my best code ever this past year and I attribute a lot of that to the fact that my code has been constantly code-reviewed, that I&#x27;ve learned so so much from my colleagues and that we (almost) never get stuck.</p>
<p>Most of my time nowadays isn&#x27;t even spent at the keyboard, but rather in a chair to the side discussing the problem we&#x27;re trying to solve. In the same way as <a href="https://en.wikipedia.org/wiki/Learning_by_teaching">learning by teaching</a> is a great way to learn, constantly discussing the code I write is a great way for me to improve.</p>
<p>And while it might be rewarding to be stuck on a problem and struggle with it for some time before finally solving it, not getting stuck in the first place beats it. There is always someone in the mob who has an idea of how to solve the issue and since everyone is in the loop already, you don&#x27;t have to explain the context when discussing it.</p>
<p>Hopefully, I&#x27;ve also helped my colleagues write the best possible code and taught them something along the way.</p>
<h2>Interpersonal issues</h2>
<p>Working this close to other people all day every day isn&#x27;t just hunky-dory though. It also means that interpersonal issues rise to the surface quicker than they might otherwise do. While I do see this as a net win, it also requires that everyone dares to be vulnerable, open up and discuss their feelings.</p>
<p>This is something you have to continuously work on if you do mob programming. It is extremely important to build a team where everyone feels safe since so much work is done closely together.</p>
<p>However, regardless of how your way of working looks, your team <a href="https://rework.withgoogle.com/blog/five-keys-to-a-successful-google-team/">will perform better</a> if they dare to open up to each other and be vulnerable. There are a lot of resources out there about this but I recommend everyone to read the book <a href="https://www.amazon.com/Dare-Lead-Brave-Conversations-Hearts/dp/0399592520">Dare to Lead</a> by BrenÃ© Brown.</p>
<blockquote>
<p>â€œLeaders must either invest a reasonable amount of time attending to fears and feelings, or squander an unreasonable amount of time trying to manage ineffective and unproductive behavior.â€ ï¼ Dare to Lead</p>
</blockquote>
<h2>Scaling is hard</h2>
<p>I joined the project as my current team grew to six developers, and today we&#x27;ve grown to a total of nine. In my opinion, this has been one of our biggest challenges and is something we still struggle with.</p>
<p>When we were six people we usually split into one or two mobs depending on if someone was sick or working from home. This worked great. We didn&#x27;t have to spend time syncing what the others did since we sat so close together and almost always worked on the same thing. Now that we&#x27;re nine and have added just one more mob station so that we usually split into three groups, some of the benefits of mob programming are suffering.</p>
<p>We immediately get some knowledge silos since some people end up working on certain parts of the application for a longer time than others, and hence learns more about it. There is also more overhead communicating between us. It&#x27;s surprising how much of a difference just one more mob does to the ability to keep track of what everyone is doing.</p>
<p>If you have any experience scaling a mob programming team I&#x27;d love to hear your thoughts.</p>
<h2>In the end</h2>
<p>Mob programming might not fit everyone but I do think that it is an excellent tool to use as a developer. I&#x27;ve had an extremely fun, rewarding and developing year. Let&#x27;s hope the next one is just as good :)</p>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[NordicJS 2019]]></title>
        <id>https://antongunnarsson.com/posts/nordicjs-2019</id>
        <link href="https://antongunnarsson.com/posts/nordicjs-2019"/>
        <updated>2019-10-23T20:30:00.000Z</updated>
        <content type="html"><![CDATA[<p>A few weeks ago I attended the developer conference <a href="https://nordicjs.com">NordicJS</a> for the first time. I&#x27;ve been to quite a few other conferences in Sweden since I started working as a developer, but I have to say that this was something else. There was this very welcoming and positive feeling in the air and among the attendees that I haven&#x27;t experienced anywhere before.</p>
<p>All the talks was of very high quality and I can recommend watching them all, but below are a few thoughts on the talks that resonated with me the most.</p>
<h2>Value Driven Development</h2>
<h6>by Isa Silveira</h6>
<p>The very first talk of the conference was Isa Silveira talking about Value Driven Development and opening the talk in a very personal, authentic and vulerable way. She talked about meeting her current partner at last years NordicJS, moving to Sweden from Brazil and using that as a segway into the core of the talk, value driven development.</p>
<p>She talked about how we as developers have an accountability for what we do but that we&#x27;re also in a position of power in todays society. How are we gonna shift our culture from being solution driven to value driven? And can we use software as a tool to reduce human suffering?</p>
<p>The talk was a great start of the conference and really set the tone for the next two days, and I wholeheartedly recommend watching it.</p>
<p><a href="https://www.youtube.com/watch?v=8BIcQLlsGl0">Watch on YouTube.</a></p>
<h2>Gettinâ€™ into the (Tensor)Flow</h2>
<h6>by PiÃ©rre Reimertz</h6>
<p>I&#x27;ve tried to learn TensorFlow way to many times, and failed way to many times. I&#x27;ve never found a tutorial or introduction that was light hearted enough to keep me inspired but still compact enough to actually teach me something. But along came PiÃ©rres talk at NordicJS.</p>
<p>By combining a fun, practical introduction to real life examples of machine learning with an introduction to the internals of TensorFlow(.js) we get an excellent talk using machine learning as a web developer.</p>
<p>I can&#x27;t say that I know TensorFlow after watching this talk, but I feel that I have better foundation and I&#x27;m definately more inspired to try and learn TensorFlow.js again.</p>
<p><a href="https://www.youtube.com/watch?v=9dFirBNYK1E">Watch on YouTube.</a></p>
<h2>Build dumb sh*t</h2>
<h6>by Sara Vieira</h6>
<p>Finishing off the entire conference was this amazing talk by the <strong>hilarious</strong> Sara Vieira about &quot;building dumb shit&quot;. I don&#x27;t want to go into to much details about the talk because I believe it&#x27;s much better if you watch it for yourself. But I&#x27;ll say that you&#x27;ll hear about (not) making the world a better place, why useless is not worthless, what an NPM drinking game looks like and much much more. Just watch it.</p>
<p>It was a perfect mix of serious and silly and ended up being my favorite talk of the conference. So inspiring and motivating that at a hackathon a week later I developed a chrome extension that screams back when you scream at your computer Â¯\_(ãƒ„)_/Â¯</p>
<p><a href="https://www.youtube.com/watch?v=zVsV01k1xUU">Watch on YouTube.</a></p>
<h4>Finally</h4>
<p>The entire conference was live streamed at Twitch (<a href="https://www.twitch.tv/videos/492603232">day 1</a> &amp; <a href="https://www.twitch.tv/videos/493016688">day 2</a>) and all videos have also been uploaded to <a href="https://www.youtube.com/user/nordicjs">YouTube</a>. It was by far the greatest conference I&#x27;ve attended so if you get the chance to attend I highly recommend it.</p>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Opinions on React]]></title>
        <id>https://antongunnarsson.com/posts/opinions-on-react</id>
        <link href="https://antongunnarsson.com/posts/opinions-on-react"/>
        <updated>2022-02-15T08:10:00.000Z</updated>
        <content type="html"><![CDATA[<p>Since I tend to forget why I hold certain opinions I try to write them down. Here are some thoughts related to React.</p>
<h3>The Opinions</h3>
<ul>
<li><a href="#indexjs">Don&#x27;t name files index.js</a></li>
<li><a href="#unnamed-exports">No unnamed exports</a></li>
<li><a href="#companion-code">Put companion code below components</a></li>
<li><a href="#return-early">Return JSX early over having a single return</a></li>
<li><a href="#typescript">Don&#x27;t create React projects without TypeScript</a></li>
<li><a href="#no-margin">Components should not have margin</a></li>
</ul>
<div class="Callout__Wrapper-sc-ecc76565-0 ibhdIn"><p>I&#x27;ve also written about <a href="https://antongunnarsson.com/react-component-code-smells">code smells in React</a> that is a little bit less opinionated than this.</p></div>
<h2><a id="indexjs"></a> Don&#x27;t name files index.js</h2>
<p>Components should be put in a file called ComponentName.js. It makes it way easier to find the correct file, navigate between files and see what files are open. Another benefit is that it&#x27;s way easier to name files for your tests: ComponentName.test.js is way better than index.test.js for the 111th time.</p>
<p>This also means you should never have an index.js file in folder just to export that folders components again.</p>
<p>The counter argument to this is usually that the import paths looks nicer/is easier to write and to that I say: <strong>You should never write your imports manually</strong>. There&#x27;s a reason we have automatic imports in all modern editors. If your editor can&#x27;t do it, switch editor.</p>
<h2><a id="unnamed-exports"></a> No unnamed exports</h2>
<p>Don&#x27;t export unnamed components. For example:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#AF00DB">export</span><span style="color:#000000"> </span><span style="color:#AF00DB">default</span><span style="color:#000000"> () </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;div&gt;</span><span style="color:#000000">hello</span><span style="color:#800000">&lt;/div&gt;</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>This makes it harder for your editor to help with autocomplete, and makes the name of the component show up as &quot;_default&quot; in React DevTools.</p>
<h2><a id="companion-code"></a> Put companion code below components</h2>
<p>Companion code refers to code that is related, or a <em>companion</em>, to a single component but not strictly a part of it. This could be things like <a href="https://styled-components.com">styled-components</a>, a very specific utility function or something else entirely.</p>
<p>All this companion code should be put <strong>below</strong> your component definition. The reason is that when you open a file with a component you want to see the component definition first. How a utility function works or how it&#x27;s styling is defined is implementation details. It&#x27;s not interesting at first sight. Especially not if it&#x27;s the first time you are seeing the code.</p>
<p>There are of course cases where companion code should be put in other files, but then it&#x27;s most likely not companion code any more.</p>
<p><em>(and if your linter complains about something being used before it&#x27;s defined, turn it off. It&#x27;s 2022 after all.)</em></p>
<h2><a id="return-early"></a> Return JSX early over having a single return</h2>
<p>By returning early you make the code path easier to follow. When trying to understand a code path you know that as soon as you hit <code>return</code> you don&#x27;t need to care about the code below it. If you&#x27;d aim for a single return you would always need to keep the entire context in mind regardless of what code path you are looking at.</p>
<p>Here&#x27;s an example of a component with a single return:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">Component</span><span style="color:#000000"> = ({ </span><span style="color:#001080">input</span><span style="color:#000000"> }) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">let</span><span style="color:#000000"> </span><span style="color:#001080">text</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">switch</span><span style="color:#000000"> (</span><span style="color:#001080">input</span><span style="color:#000000">) {</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#AF00DB">case</span><span style="color:#000000"> </span><span style="color:#A31515">&#x27;foo&#x27;</span><span style="color:#000000">:</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#001080">text</span><span style="color:#000000"> = </span><span style="color:#A31515">&#x27;first text&#x27;</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#AF00DB">break</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#AF00DB">case</span><span style="color:#000000"> </span><span style="color:#A31515">&#x27;bar&#x27;</span><span style="color:#000000">:</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#001080">text</span><span style="color:#000000"> = </span><span style="color:#A31515">&#x27;second text&#x27;</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#AF00DB">break</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#AF00DB">case</span><span style="color:#000000"> </span><span style="color:#A31515">&#x27;baz&#x27;</span><span style="color:#000000">:</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#001080">text</span><span style="color:#000000"> = </span><span style="color:#A31515">&#x27;third text&#x27;</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#AF00DB">break</span></span>
<span class="line"><span style="color:#000000">  }</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;div&gt;</span><span style="color:#000000">our text: </span><span style="color:#0000FF">{</span><span style="color:#001080">text</span><span style="color:#0000FF">}</span><span style="color:#800000">&lt;/div&gt;</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>And here is the same component rewritten to return early:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">Component</span><span style="color:#000000"> = ({ </span><span style="color:#001080">input</span><span style="color:#000000"> }) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">switch</span><span style="color:#000000"> (</span><span style="color:#001080">input</span><span style="color:#000000">) {</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#AF00DB">case</span><span style="color:#000000"> </span><span style="color:#A31515">&#x27;foo&#x27;</span><span style="color:#000000">:</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;div&gt;</span><span style="color:#000000">our text: first text</span><span style="color:#800000">&lt;/div&gt;</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#AF00DB">case</span><span style="color:#000000"> </span><span style="color:#A31515">&#x27;bar&#x27;</span><span style="color:#000000">:</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;div&gt;</span><span style="color:#000000">our text: second text</span><span style="color:#800000">&lt;/div&gt;</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#AF00DB">case</span><span style="color:#000000"> </span><span style="color:#A31515">&#x27;baz&#x27;</span><span style="color:#000000">:</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;div&gt;</span><span style="color:#000000">our text: third text</span><span style="color:#800000">&lt;/div&gt;</span></span>
<span class="line"><span style="color:#000000">  }</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>This reads much better than the first example. If you&#x27;re worried about the duplication of the div (you probably shouldn&#x27;t be) you can just abstract that to a new component which takes the dynamic text as a child/prop.</p>
<h2><a id="typescript"></a> Don&#x27;t create React projects without TypeScript</h2>
<p>TypeScript is fantastic and you should use it for all your (new) React projects. It&#x27;s not merely about the fact that types help you write less bugs (which they do), but more so that it reduces the mental load of working with the code.</p>
<p>No more searching through files and folders to find answers to questions such as &quot;What props does this component have?&quot;, &quot;How did I structure my state?&quot; or &quot;What input does this hook need?&quot;. TypeScript will tell you.</p>
<p>No more double checking every thing you do while refactoring do make sure you haven&#x27;t accidentaly misspelled a component prop or passed the wrong data. TypeScript will tell you.</p>
<p>Yes, TypeScript is love â¤ï¸</p>
<p>If you&#x27;re struggling with TS in React this <a href="https://github.com/typescript-cheatsheets/react">cheatsheet</a> is great.</p>
<h2><a id="no-margin"></a> Components should not have margin</h2>
<p>You should avoid adding margin to your components as it makes them harder to reuse and compose. Max Stoiber has elaborated on this more succinctly than I can so go read his post <a href="https://mxstbr.com/thoughts/margin/">Margin considered harmful</a>.</p>
<p>When you&#x27;ve read that and come back here either confused, angry or excited about spacer components (which I <em>love</em>) go read Josh&#x27;s excellent article <a href="https://www.joshwcomeau.com/react/modern-spacer-gif/">Let&#x27;s Bring Spacer GIFs Back</a>.</p>
<p>Embrace both and it will make everything easier. I promise ðŸ¤ž</p>
<h2>That&#x27;s all folks!</h2>
<p>Got any feedback on why I&#x27;m <em>very wrong</em> about this? Hit me up on <a href="https://twitter.com/awnton">Twitter</a>!</p>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[React component code smells]]></title>
        <id>https://antongunnarsson.com/posts/react-component-code-smells</id>
        <link href="https://antongunnarsson.com/posts/react-component-code-smells"/>
        <updated>2020-08-13T20:17:00.000Z</updated>
        <content type="html"><![CDATA[<p>A growing collection of code smells in React components.</p>
<div class="Callout__Wrapper-sc-ecc76565-0 ibhdIn"><p><strong>What&#x27;s a code smell?</strong> A code smell is something that <em>could</em> indicate a deeper problem within a code base, but isn&#x27;t necessarily a bug. More information on <a href="https://en.wikipedia.org/wiki/Code_smell">Wikipedia</a>.</p></div>
<h3>The smells ðŸ’©</h3>
<ul>
<li><a href="#too-many-props">Too many props</a></li>
<li><a href="#incompatible-props">Incompatible props</a></li>
<li><a href="#props-in-state">Copying props into state</a></li>
<li><a href="#jsx-returns">Returning JSX from functions</a></li>
<li><a href="#multiple-booleans">Multiple booleans for state</a></li>
<li><a href="#many-usestate">Too many useState in a component</a></li>
<li><a href="#large-useeffect">Large useEffect</a></li>
</ul>
<h2><a id="too-many-props"></a> Too many props</h2>
<p>Passing too many props into a single component may be a sign that the component should be split up.</p>
<p>How many are too many you ask? Well.. &quot;it depends&quot;. You might find yourself in a situation where a component have 20 props or more, and still be satisfied that it only does one thing. But when you do stumble upon a component that has many props or you get the urge to add <em>just one more</em> to the already long list of props there&#x27;s a couple of things to consider:</p>
<h4>Is this component doing multiple things?</h4>
<p>Like functions, components should do <em>one thing well</em> so it&#x27;s always good to check if it&#x27;s possible to split the component into multiple smaller components. For example if the component has <a href="#incompatible-props">incompatible props</a> or <a href="#jsx-returns">returns JSX from functions</a>.</p>
<h4>Could I use composition?</h4>
<p>A pattern that is very good but often overlooked is to compose components instead of handling all logic inside just one. Let&#x27;s say we have a component that handles a user application to some organization:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#800000">&lt;</span><span style="color:#267F99">ApplicationForm</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#FF0000">user</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">userData</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#FF0000">organization</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">organizationData</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#FF0000">categories</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">categoriesData</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#FF0000">locations</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">locationsData</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#FF0000">onSubmit</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">handleSubmit</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#FF0000">onCancel</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">handleCancel</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#CD3131">...</span></span>
<span class="line"><span style="color:#800000">/&gt;</span></span></code></pre></div>
<p>Looking at the props of this component we can see that all of them are related to what the component does, but there&#x27;s still room to improve this by moving some of the components responsibility to its children instead:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#800000">&lt;</span><span style="color:#267F99">ApplicationForm</span><span style="color:#000000"> </span><span style="color:#FF0000">onSubmit</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">handleSubmit</span><span style="color:#0000FF">}</span><span style="color:#000000"> </span><span style="color:#FF0000">onCancel</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">handleCancel</span><span style="color:#0000FF">}</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#800000">&lt;</span><span style="color:#267F99">UserField</span><span style="color:#000000"> </span><span style="color:#FF0000">user</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">userData</span><span style="color:#0000FF">}</span><span style="color:#000000"> </span><span style="color:#800000">/&gt;</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#800000">&lt;</span><span style="color:#267F99">OrganizationField</span><span style="color:#000000"> </span><span style="color:#FF0000">organization</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">organizationData</span><span style="color:#0000FF">}</span><span style="color:#000000"> </span><span style="color:#800000">/&gt;</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#800000">&lt;</span><span style="color:#267F99">CategoryField</span><span style="color:#000000"> </span><span style="color:#FF0000">categories</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">categoriesData</span><span style="color:#0000FF">}</span><span style="color:#000000"> </span><span style="color:#800000">/&gt;</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#800000">&lt;</span><span style="color:#267F99">LocationsField</span><span style="color:#000000"> </span><span style="color:#FF0000">locations</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">locationsData</span><span style="color:#0000FF">}</span><span style="color:#000000"> </span><span style="color:#800000">/&gt;</span></span>
<span class="line"><span style="color:#800000">&lt;/</span><span style="color:#267F99">ApplicationForm</span><span style="color:#800000">&gt;</span></span></code></pre></div>
<p>Now we&#x27;ve made sure that the <code>ApplicationForm</code> only handles its most narrow responsibility, submitting and canceling the form. The child components can handle everything related to their part of the bigger picture. This is also a great opportunity to use <a href="https://reactjs.org/docs/context.html">React Context</a> for the communication between the children and their parent.</p>
<div class="Callout__Wrapper-sc-ecc76565-0 ibhdIn"><p>Read more about how to build <a href="https://antongunnarsson.com/compound-components-in-react/">compound components in React</a>.</p></div>
<h4>Am I passing down many &#x27;configuration&#x27;-props?</h4>
<p>In some cases, it&#x27;s a good idea to group together props into an options object, for example to make it easier to swap this configuration. If we have a component that displays some sort of grid or table:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#800000">&lt;</span><span style="color:#267F99">Grid</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#FF0000">data</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">gridData</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#FF0000">pagination</span><span style="color:#000000">=</span><span style="color:#0000FF">{false}</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#FF0000">autoSize</span><span style="color:#000000">=</span><span style="color:#0000FF">{true}</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#FF0000">enableSort</span><span style="color:#000000">=</span><span style="color:#0000FF">{true}</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#FF0000">sortOrder</span><span style="color:#000000">=</span><span style="color:#A31515">&quot;desc&quot;</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#FF0000">disableSelection</span><span style="color:#000000">=</span><span style="color:#0000FF">{true}</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#FF0000">infiniteScroll</span><span style="color:#000000">=</span><span style="color:#0000FF">{true}</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#CD3131">...</span></span>
<span class="line"><span style="color:#800000">/&gt;</span></span></code></pre></div>
<p>All of these props except <code>data</code> could be considered <em>configuration</em>. In cases like this it&#x27;s sometimes a good idea to change the <code>Grid</code> so that it accepts an <code>options</code> prop instead.</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">options</span><span style="color:#000000"> = {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#001080">pagination:</span><span style="color:#000000"> </span><span style="color:#0000FF">false</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#001080">autoSize:</span><span style="color:#000000"> </span><span style="color:#0000FF">true</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#001080">enableSort:</span><span style="color:#000000"> </span><span style="color:#0000FF">true</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#001080">sortOrder:</span><span style="color:#000000"> </span><span style="color:#A31515">&#x27;desc&#x27;</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#001080">disableSelection:</span><span style="color:#000000"> </span><span style="color:#0000FF">true</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#001080">infiniteScroll:</span><span style="color:#000000"> </span><span style="color:#0000FF">true</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">  ...</span></span>
<span class="line"><span style="color:#000000">}</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#800000">&lt;</span><span style="color:#267F99">Grid</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#FF0000">data</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">gridData</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#FF0000">options</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">options</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#800000">/&gt;</span></span></code></pre></div>
<p>This also means that it&#x27;s easier to exclude configuration options we don&#x27;t want to use if we&#x27;re swapping between different <code>options</code>.</p>
<h2><a id="incompatible-props"></a> Incompatible props</h2>
<p>Avoid passing props that are incompatible with each other.</p>
<p>For instance, we might start by creating a common <code>&lt;Input /&gt;</code> component that is intended to just handle text, but after a while we also add the possibility to use it for phone numbers as well. The implementation could look something like this:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">Input</span><span style="color:#000000">({ </span><span style="color:#001080">value</span><span style="color:#000000">, </span><span style="color:#001080">isPhoneNumberInput</span><span style="color:#000000">, </span><span style="color:#001080">autoCapitalize</span><span style="color:#000000"> }) {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">if</span><span style="color:#000000"> (</span><span style="color:#001080">autoCapitalize</span><span style="color:#000000">) </span><span style="color:#795E26">capitalize</span><span style="color:#000000">(</span><span style="color:#001080">value</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;input</span><span style="color:#000000"> </span><span style="color:#FF0000">value</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">value</span><span style="color:#0000FF">}</span><span style="color:#000000"> </span><span style="color:#FF0000">type</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">isPhoneNumberInput</span><span style="color:#000000FF"> </span><span style="color:#000000">?</span><span style="color:#000000FF"> </span><span style="color:#A31515">&#x27;tel&#x27;</span><span style="color:#000000FF"> </span><span style="color:#000000">:</span><span style="color:#000000FF"> </span><span style="color:#A31515">&#x27;text&#x27;</span><span style="color:#0000FF">}</span><span style="color:#000000"> </span><span style="color:#800000">/&gt;</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>The problem with this is that the props <code>isPhoneNumberInput</code> and <code>autoCapitalize</code> don&#x27;t make sense together. We can&#x27;t really capitalize phone numbers.</p>
<p>In this case the solution is probably to break the component up into multiple smaller components. If we still have some logic we want to share between them, we can move it to a <a href="https://reactjs.org/docs/hooks-custom.html">custom hook</a>:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">TextInput</span><span style="color:#000000">({ </span><span style="color:#001080">value</span><span style="color:#000000">, </span><span style="color:#001080">autoCapitalize</span><span style="color:#000000"> }) {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">if</span><span style="color:#000000"> (</span><span style="color:#001080">autoCapitalize</span><span style="color:#000000">) </span><span style="color:#795E26">capitalize</span><span style="color:#000000">(</span><span style="color:#001080">value</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#795E26">useSharedInputLogic</span><span style="color:#000000">()</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;input</span><span style="color:#000000"> </span><span style="color:#FF0000">value</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">value</span><span style="color:#0000FF">}</span><span style="color:#000000"> </span><span style="color:#FF0000">type</span><span style="color:#000000">=</span><span style="color:#A31515">&quot;text&quot;</span><span style="color:#000000"> </span><span style="color:#800000">/&gt;</span></span>
<span class="line"><span style="color:#000000">}</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">PhoneNumberInput</span><span style="color:#000000">({ </span><span style="color:#001080">value</span><span style="color:#000000"> }) {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#795E26">useSharedInputLogic</span><span style="color:#000000">()</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;input</span><span style="color:#000000"> </span><span style="color:#FF0000">value</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">value</span><span style="color:#0000FF">}</span><span style="color:#000000"> </span><span style="color:#FF0000">type</span><span style="color:#000000">=</span><span style="color:#A31515">&quot;tel&quot;</span><span style="color:#000000"> </span><span style="color:#800000">/&gt;</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>While this example is a bit contrived, finding props that are incompatible with each other is usually a good indication that you should check if the component needs to be broken apart.</p>
<h2><a id="props-in-state"></a> Copying props into state</h2>
<p>Don&#x27;t stop the data flow by copying props into state.</p>
<p>Consider this component:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">Button</span><span style="color:#000000">({ </span><span style="color:#001080">text</span><span style="color:#000000"> }) {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> [</span><span style="color:#0070C1">buttonText</span><span style="color:#000000">] = </span><span style="color:#795E26">useState</span><span style="color:#000000">(</span><span style="color:#001080">text</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;button&gt;</span><span style="color:#0000FF">{</span><span style="color:#001080">buttonText</span><span style="color:#0000FF">}</span><span style="color:#800000">&lt;/button&gt;</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>By passing the <code>text</code> prop as the initial value of useState the component now practically <em>ignores</em> all updated values of <code>text</code>. If the <code>text</code> prop was updated the component would still render its first value. For most props this is unexpected behavior which in turn makes the component more bug-prone.</p>
<p>A more practical example of this happening is when we want to derive some new value from a prop and especially if this requires some slow calculation. In the example below, we run the <code>slowlyFormatText</code> function to format our <code>text</code>-prop, which takes a lot of time to execute.</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">Button</span><span style="color:#000000">({ </span><span style="color:#001080">text</span><span style="color:#000000"> }) {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> [</span><span style="color:#0070C1">formattedText</span><span style="color:#000000">] = </span><span style="color:#795E26">useState</span><span style="color:#000000">(() </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> </span><span style="color:#795E26">slowlyFormatText</span><span style="color:#000000">(</span><span style="color:#001080">text</span><span style="color:#000000">))</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;button&gt;</span><span style="color:#0000FF">{</span><span style="color:#001080">formattedText</span><span style="color:#0000FF">}</span><span style="color:#800000">&lt;/button&gt;</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>By putting it into state we&#x27;ve solved the issue that it will rerun unnecessarily but like above we&#x27;ve also stopped the component from updating. A better way to solving this issue is using the <a href="https://reactjs.org/docs/hooks-reference.html#usememo">useMemo hook</a> to <em>memoize</em> the result:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">Button</span><span style="color:#000000">({ </span><span style="color:#001080">text</span><span style="color:#000000"> }) {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">formattedText</span><span style="color:#000000"> = </span><span style="color:#795E26">useMemo</span><span style="color:#000000">(() </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> </span><span style="color:#795E26">slowlyFormatText</span><span style="color:#000000">(</span><span style="color:#001080">text</span><span style="color:#000000">), [</span><span style="color:#001080">text</span><span style="color:#000000">])</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;button&gt;</span><span style="color:#0000FF">{</span><span style="color:#001080">formattedText</span><span style="color:#0000FF">}</span><span style="color:#800000">&lt;/button&gt;</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>Now <code>slowlyFormatText</code> only runs when <code>text</code> changes and we haven&#x27;t stopped the component from updating.</p>
<div class="Callout__Wrapper-sc-ecc76565-0 ibhdIn"><p>Sometimes we do need a prop where all updates to it are ignored, e.g. a color picker where we need the option to set an initially picked color but when the user has picked a color we don&#x27;t want an update to override the users choice. In this case it&#x27;s totally fine to copy the prop into state, but to indicate this behavior to the user most developers prefix the prop with either initial or default (<code>initialColor</code>/<code>defaultColor</code>).</p></div>
<p>Further reading: <a href="https://overreacted.io/writing-resilient-components/">Writing resilient components by Dan Abramov</a>.</p>
<h2><a id="jsx-returns"></a> Returning JSX from functions</h2>
<p>Don&#x27;t return JSX from functions inside a component.</p>
<p>This is a pattern that has largely disappeared when function components became more popular, but I still run into it from time to time. Just to give an example of what I mean:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">Component</span><span style="color:#000000">() {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">topSection</span><span style="color:#000000"> = () </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#AF00DB">return</span><span style="color:#000000"> (</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#800000">&lt;header&gt;</span></span>
<span class="line"><span style="color:#000000">        </span><span style="color:#800000">&lt;h1&gt;</span><span style="color:#000000">Component header</span><span style="color:#800000">&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#800000">&lt;/header&gt;</span></span>
<span class="line"><span style="color:#000000">    )</span></span>
<span class="line"><span style="color:#000000">  }</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">middleSection</span><span style="color:#000000"> = () </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#AF00DB">return</span><span style="color:#000000"> (</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#800000">&lt;main&gt;</span></span>
<span class="line"><span style="color:#000000">        </span><span style="color:#800000">&lt;p&gt;</span><span style="color:#000000">Some text</span><span style="color:#800000">&lt;/p&gt;</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#800000">&lt;/main&gt;</span></span>
<span class="line"><span style="color:#000000">    )</span></span>
<span class="line"><span style="color:#000000">  }</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">bottomSection</span><span style="color:#000000"> = () </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#AF00DB">return</span><span style="color:#000000"> (</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#800000">&lt;footer&gt;</span></span>
<span class="line"><span style="color:#000000">        </span><span style="color:#800000">&lt;p&gt;</span><span style="color:#000000">Some footer text</span><span style="color:#800000">&lt;/p&gt;</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#800000">&lt;/footer&gt;</span></span>
<span class="line"><span style="color:#000000">    )</span></span>
<span class="line"><span style="color:#000000">  }</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> (</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#800000">&lt;div&gt;</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#0000FF">{</span><span style="color:#795E26">topSection</span><span style="color:#000000FF">()</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#0000FF">{</span><span style="color:#795E26">middleSection</span><span style="color:#000000FF">()</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#0000FF">{</span><span style="color:#795E26">bottomSection</span><span style="color:#000000FF">()</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#800000">&lt;/div&gt;</span></span>
<span class="line"><span style="color:#000000">  )</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>While this might feel okay at first it makes it hard to reason about the code, discourages good patterns, and should be avoided. To solve it I either inline the JSX because a large return isn&#x27;t <em>that big</em> of a problem, but more often this is a reason to break these sections into separate components instead.</p>
<div class="Callout__Wrapper-sc-ecc76565-0 ibhdIn"><p>Remember that just because you create a new component you don&#x27;t have to move it to a new file as well. Sometimes it makes sense to keep multiple components in the same file if they are tightly coupled.</p></div>
<h2><a id="multiple-booleans"></a> Multiple booleans for state</h2>
<p>Avoid using multiple booleans to represent a components state.</p>
<p>When writing a component and subsequently extending the functionality of the component it&#x27;s easy to end up in a situation where you have multiple booleans to indicate which state the component is in. For a small component that does a web request when you click a button you might have something like this:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">Component</span><span style="color:#000000">() {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> [</span><span style="color:#0070C1">isLoading</span><span style="color:#000000">, </span><span style="color:#0070C1">setIsLoading</span><span style="color:#000000">] = </span><span style="color:#795E26">useState</span><span style="color:#000000">(</span><span style="color:#0000FF">false</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> [</span><span style="color:#0070C1">isFinished</span><span style="color:#000000">, </span><span style="color:#0070C1">setIsFinished</span><span style="color:#000000">] = </span><span style="color:#795E26">useState</span><span style="color:#000000">(</span><span style="color:#0000FF">false</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> [</span><span style="color:#0070C1">hasError</span><span style="color:#000000">, </span><span style="color:#0070C1">setHasError</span><span style="color:#000000">] = </span><span style="color:#795E26">useState</span><span style="color:#000000">(</span><span style="color:#0000FF">false</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">fetchSomething</span><span style="color:#000000"> = () </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#795E26">setIsLoading</span><span style="color:#000000">(</span><span style="color:#0000FF">true</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">    </span><span style="color:#795E26">fetch</span><span style="color:#000000">(</span><span style="color:#001080">url</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">      .</span><span style="color:#795E26">then</span><span style="color:#000000">(() </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">        </span><span style="color:#795E26">setIsLoading</span><span style="color:#000000">(</span><span style="color:#0000FF">false</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">        </span><span style="color:#795E26">setIsFinished</span><span style="color:#000000">(</span><span style="color:#0000FF">true</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">      })</span></span>
<span class="line"><span style="color:#000000">      .</span><span style="color:#795E26">catch</span><span style="color:#000000">(() </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">        </span><span style="color:#795E26">setHasError</span><span style="color:#000000">(</span><span style="color:#0000FF">true</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">      })</span></span>
<span class="line"><span style="color:#000000">  }</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">if</span><span style="color:#000000"> (</span><span style="color:#001080">isLoading</span><span style="color:#000000">) </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Loader</span><span style="color:#000000"> </span><span style="color:#800000">/&gt;</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">if</span><span style="color:#000000"> (</span><span style="color:#001080">hasError</span><span style="color:#000000">) </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Error</span><span style="color:#000000"> </span><span style="color:#800000">/&gt;</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">if</span><span style="color:#000000"> (</span><span style="color:#001080">isFinished</span><span style="color:#000000">) </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Success</span><span style="color:#000000"> </span><span style="color:#800000">/&gt;</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;button</span><span style="color:#000000"> </span><span style="color:#FF0000">onClick</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">fetchSomething</span><span style="color:#0000FF">}</span><span style="color:#000000"> </span><span style="color:#800000">/&gt;</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>When the button is clicked we set <code>isLoading</code> to true and do a web request with fetch. If the request is successful we set <code>isLoading</code> to false and <code>isFinished</code> to true and otherwise set <code>hasError</code> to true if there was an error.</p>
<p>While this technically works fine it&#x27;s hard to reason about what state the component is in and it&#x27;s more error-prone than alternatives. We could also end up in an &quot;impossible state&quot;, such as if we accidentally set both <code>isLoading</code> and <code>isFinished</code> to true at the same time.</p>
<p>A better way to handle this is to manage the state with an &quot;enum&quot; instead. In other languages enums are a way to define a variable that is only allowed to be set to a predefined collection of constant values, and while enums don&#x27;t technically exist in Javascript we can use a string as an enum and still get a lot of benefits:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">Component</span><span style="color:#000000">() {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> [</span><span style="color:#0070C1">state</span><span style="color:#000000">, </span><span style="color:#0070C1">setState</span><span style="color:#000000">] = </span><span style="color:#795E26">useState</span><span style="color:#000000">(</span><span style="color:#A31515">&#x27;idle&#x27;</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">fetchSomething</span><span style="color:#000000"> = () </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#795E26">setState</span><span style="color:#000000">(</span><span style="color:#A31515">&#x27;loading&#x27;</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">    </span><span style="color:#795E26">fetch</span><span style="color:#000000">(</span><span style="color:#001080">url</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">      .</span><span style="color:#795E26">then</span><span style="color:#000000">(() </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">        </span><span style="color:#795E26">setState</span><span style="color:#000000">(</span><span style="color:#A31515">&#x27;finished&#x27;</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">      })</span></span>
<span class="line"><span style="color:#000000">      .</span><span style="color:#795E26">catch</span><span style="color:#000000">(() </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">        </span><span style="color:#795E26">setState</span><span style="color:#000000">(</span><span style="color:#A31515">&#x27;error&#x27;</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">      })</span></span>
<span class="line"><span style="color:#000000">  }</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">if</span><span style="color:#000000"> (</span><span style="color:#001080">state</span><span style="color:#000000"> === </span><span style="color:#A31515">&#x27;loading&#x27;</span><span style="color:#000000">) </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Loader</span><span style="color:#000000"> </span><span style="color:#800000">/&gt;</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">if</span><span style="color:#000000"> (</span><span style="color:#001080">state</span><span style="color:#000000"> === </span><span style="color:#A31515">&#x27;error&#x27;</span><span style="color:#000000">) </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Error</span><span style="color:#000000"> </span><span style="color:#800000">/&gt;</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">if</span><span style="color:#000000"> (</span><span style="color:#001080">state</span><span style="color:#000000"> === </span><span style="color:#A31515">&#x27;finished&#x27;</span><span style="color:#000000">) </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Success</span><span style="color:#000000"> </span><span style="color:#800000">/&gt;</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;button</span><span style="color:#000000"> </span><span style="color:#FF0000">onClick</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">fetchSomething</span><span style="color:#0000FF">}</span><span style="color:#000000"> </span><span style="color:#800000">/&gt;</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>By doing it this way we&#x27;ve removed the possibility for impossible states and made it <strong>much</strong> easier to reason about this component. Finally, if you&#x27;re using some sort of type system like TypeScript it&#x27;s even better since you can specify the possible states:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="ts" data-theme="default"><span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> [</span><span style="color:#0070C1">state</span><span style="color:#000000">, </span><span style="color:#0070C1">setState</span><span style="color:#000000">] = </span><span style="color:#795E26">useState</span><span style="color:#000000">&lt;</span><span style="color:#A31515">&#x27;idle&#x27;</span><span style="color:#000000"> | </span><span style="color:#A31515">&#x27;loading&#x27;</span><span style="color:#000000"> | </span><span style="color:#A31515">&#x27;error&#x27;</span><span style="color:#000000"> | </span><span style="color:#A31515">&#x27;finished&#x27;</span><span style="color:#000000">&gt;(</span><span style="color:#A31515">&#x27;idle&#x27;</span><span style="color:#000000">)</span></span></code></pre></div>
<h2><a id="many-usestate"></a> Too many useState</h2>
<p>Avoid using too many <code>useState</code> hooks in the same component.</p>
<p>A component with many <code>useState</code> hooks is likely doing Too Many Thingsâ„¢ï¸ and probably a good candidate for breaking into multiple components, but there are also some complex cases where we need to manage some complex state in a single component.</p>
<p>Here&#x27;s an example of how some state and a couple of functions in an autocomplete input component could look like:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">AutocompleteInput</span><span style="color:#000000">() {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> [</span><span style="color:#0070C1">isOpen</span><span style="color:#000000">, </span><span style="color:#0070C1">setIsOpen</span><span style="color:#000000">] = </span><span style="color:#795E26">useState</span><span style="color:#000000">(</span><span style="color:#0000FF">false</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> [</span><span style="color:#0070C1">inputValue</span><span style="color:#000000">, </span><span style="color:#0070C1">setInputValue</span><span style="color:#000000">] = </span><span style="color:#795E26">useState</span><span style="color:#000000">(</span><span style="color:#A31515">&#x27;&#x27;</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> [</span><span style="color:#0070C1">items</span><span style="color:#000000">, </span><span style="color:#0070C1">setItems</span><span style="color:#000000">] = </span><span style="color:#795E26">useState</span><span style="color:#000000">([])</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> [</span><span style="color:#0070C1">selectedItem</span><span style="color:#000000">, </span><span style="color:#0070C1">setSelectedItem</span><span style="color:#000000">] = </span><span style="color:#795E26">useState</span><span style="color:#000000">(</span><span style="color:#0000FF">null</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> [</span><span style="color:#0070C1">activeIndex</span><span style="color:#000000">, </span><span style="color:#0070C1">setActiveIndex</span><span style="color:#000000">] = </span><span style="color:#795E26">useState</span><span style="color:#000000">(-</span><span style="color:#098658">1</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">reset</span><span style="color:#000000"> = () </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#795E26">setIsOpen</span><span style="color:#000000">(</span><span style="color:#0000FF">false</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#795E26">setInputValue</span><span style="color:#000000">(</span><span style="color:#A31515">&#x27;&#x27;</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#795E26">setItems</span><span style="color:#000000">([])</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#795E26">setSelectedItem</span><span style="color:#000000">(</span><span style="color:#0000FF">null</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#795E26">setActiveIndex</span><span style="color:#000000">(-</span><span style="color:#098658">1</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">  }</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">selectItem</span><span style="color:#000000"> = (</span><span style="color:#001080">item</span><span style="color:#000000">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#795E26">setIsOpen</span><span style="color:#000000">(</span><span style="color:#0000FF">false</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#795E26">setInputValue</span><span style="color:#000000">(</span><span style="color:#001080">item</span><span style="color:#000000">.</span><span style="color:#001080">name</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#795E26">setSelectedItem</span><span style="color:#000000">(</span><span style="color:#001080">item</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">  }</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  ...</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>We have a <code>reset</code> function that resets all of the state and a <code>selectItem</code> function that updates some of our state. These functions both have to use quite a few state setters from all of our <code>useState</code>s to do their intended task. Now imagine that we have a lot of more actions that have to update the state and it&#x27;s easy to see that this becomes hard to keep bug free in the long run. In these cases it can be beneficial to manage our state with a <code>useReducer</code> hook instead:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">initialState</span><span style="color:#000000"> = {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#001080">isOpen:</span><span style="color:#000000"> </span><span style="color:#0000FF">false</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#001080">inputValue:</span><span style="color:#000000"> </span><span style="color:#A31515">&quot;&quot;</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#001080">items:</span><span style="color:#000000"> [],</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#001080">selectedItem:</span><span style="color:#000000"> </span><span style="color:#0000FF">null</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#001080">activeIndex:</span><span style="color:#000000"> -</span><span style="color:#098658">1</span></span>
<span class="line"><span style="color:#000000">}</span></span>
<span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">reducer</span><span style="color:#000000">(</span><span style="color:#001080">state</span><span style="color:#000000">, </span><span style="color:#001080">action</span><span style="color:#000000">) {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">switch</span><span style="color:#000000"> (</span><span style="color:#001080">action</span><span style="color:#000000">.</span><span style="color:#001080">type</span><span style="color:#000000">) {</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#AF00DB">case</span><span style="color:#000000"> </span><span style="color:#A31515">&quot;reset&quot;</span><span style="color:#000000">:</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#AF00DB">return</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">        ...</span><span style="color:#001080">initialState</span></span>
<span class="line"><span style="color:#000000">      }</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#AF00DB">case</span><span style="color:#000000"> </span><span style="color:#A31515">&quot;selectItem&quot;</span><span style="color:#000000">:</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#AF00DB">return</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">        ...</span><span style="color:#001080">state</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">        </span><span style="color:#001080">isOpen:</span><span style="color:#000000"> </span><span style="color:#0000FF">false</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">        </span><span style="color:#001080">inputValue:</span><span style="color:#000000"> </span><span style="color:#001080">action</span><span style="color:#000000">.</span><span style="color:#001080">payload</span><span style="color:#000000">.</span><span style="color:#001080">name</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">        </span><span style="color:#001080">selectedItem:</span><span style="color:#000000"> </span><span style="color:#001080">action</span><span style="color:#000000">.</span><span style="color:#001080">payload</span></span>
<span class="line"><span style="color:#000000">      }</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#AF00DB">default</span><span style="color:#000000">:</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#AF00DB">throw</span><span style="color:#000000"> </span><span style="color:#267F99">Error</span><span style="color:#000000">()</span></span>
<span class="line"><span style="color:#000000">  }</span></span>
<span class="line"><span style="color:#000000">}</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">AutocompleteInput</span><span style="color:#000000">() {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> [</span><span style="color:#0070C1">state</span><span style="color:#000000">, </span><span style="color:#0070C1">dispatch</span><span style="color:#000000">] = </span><span style="color:#795E26">useReducer</span><span style="color:#000000">(</span><span style="color:#001080">reducer</span><span style="color:#000000">, </span><span style="color:#001080">initialState</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">reset</span><span style="color:#000000"> = () </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#795E26">dispatch</span><span style="color:#000000">({ </span><span style="color:#001080">type:</span><span style="color:#000000"> </span><span style="color:#A31515">&#x27;reset&#x27;</span><span style="color:#000000"> })</span></span>
<span class="line"><span style="color:#000000">  }</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#795E26">selectItem</span><span style="color:#000000"> = (</span><span style="color:#001080">item</span><span style="color:#000000">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#795E26">dispatch</span><span style="color:#000000">({ </span><span style="color:#001080">type:</span><span style="color:#000000"> </span><span style="color:#A31515">&#x27;selectItem&#x27;</span><span style="color:#000000">, </span><span style="color:#001080">payload:</span><span style="color:#000000"> </span><span style="color:#001080">item</span><span style="color:#000000"> })</span></span>
<span class="line"><span style="color:#000000">  }</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  ...</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>By using a reducer we&#x27;ve encapsulated the logic for managing our state and moved the complexity out of our component. This makes it much easier to understand what is going on now that we can think about our state and our component separately.</p>
<div class="Callout__Wrapper-sc-ecc76565-0 ibhdIn"><p>Both <code>useState</code> and <code>useReducer</code> come with their <a href="https://kentcdodds.com/blog/should-i-usestate-or-usereducer">pros, cons</a> and different use cases (pun intended). One of my favorites with reducers is the <a href="https://kentcdodds.com/blog/the-state-reducer-pattern-with-react-hooks">state reducer pattern by Kent C. Dodds</a>.</p></div>
<h2><a id="large-useeffect"></a> Large useEffect</h2>
<p>Avoid large <code>useEffect</code>s that do multiple things. They make your code error-prone and harder to reason about.</p>
<p>A mistake that I made a lot when hooks were released was putting too many things into a single <code>useEffect</code>. To illustrate, here&#x27;s a component with a single <code>useEffect</code>:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">Post</span><span style="color:#000000">({ </span><span style="color:#001080">id</span><span style="color:#000000">, </span><span style="color:#001080">unlisted</span><span style="color:#000000"> }) {</span></span>
<span class="line"><span style="color:#000000">  ...</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#795E26">useEffect</span><span style="color:#000000">(() </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#795E26">fetch</span><span style="color:#000000">(</span><span style="color:#A31515">`/posts/</span><span style="color:#0000FF">${</span><span style="color:#001080">id</span><span style="color:#0000FF">}</span><span style="color:#A31515">`</span><span style="color:#000000">).</span><span style="color:#795E26">then</span><span style="color:#000000">(</span><span style="color:#008000">/* do something */</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">    </span><span style="color:#795E26">setVisibility</span><span style="color:#000000">(</span><span style="color:#001080">unlisted</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">  }, [</span><span style="color:#001080">id</span><span style="color:#000000">, </span><span style="color:#001080">unlisted</span><span style="color:#000000">])</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  ...</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>While this effect isn&#x27;t that large it still do multiple things. When the <code>unlisted</code> prop changes we will fetch the post even if <code>id</code> hasn&#x27;t changed.</p>
<p>To catch errors like this I try to describe the effects I write by saying &quot;when <code>[dependencies]</code> change do <em>this</em>&quot; to myself. Applying that to the effect above we get &quot;when <code>id</code> <strong>or</strong> <code>unlisted</code> changes, fetch the post <strong>and</strong> update visibility&quot;. If this sentence contains the words &quot;<strong>or</strong>&quot; or &quot;<strong>and</strong>&quot; it usually points to a problem.</p>
<p>Breaking this effect up into two effects instead:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">Post</span><span style="color:#000000">({ </span><span style="color:#001080">id</span><span style="color:#000000">, </span><span style="color:#001080">unlisted</span><span style="color:#000000"> }) {</span></span>
<span class="line"><span style="color:#000000">  ...</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#795E26">useEffect</span><span style="color:#000000">(() </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> { </span><span style="color:#008000">// when id changes fetch the post</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#795E26">fetch</span><span style="color:#000000">(</span><span style="color:#A31515">`/posts/</span><span style="color:#0000FF">${</span><span style="color:#001080">id</span><span style="color:#0000FF">}</span><span style="color:#A31515">`</span><span style="color:#000000">).</span><span style="color:#795E26">then</span><span style="color:#000000">(</span><span style="color:#008000">/* ... */</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">  }, [</span><span style="color:#001080">id</span><span style="color:#000000">])</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#795E26">useEffect</span><span style="color:#000000">(() </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> { </span><span style="color:#008000">// when unlisted changes update visibility</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#795E26">setVisibility</span><span style="color:#000000">(</span><span style="color:#001080">unlisted</span><span style="color:#000000">)</span></span>
<span class="line"><span style="color:#000000">  }, [</span><span style="color:#001080">unlisted</span><span style="color:#000000">])</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  ...</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>By doing this we&#x27;ve reduced the complexity of our component, made it easier to reason about and lowered the risk of creating bugs.</p>
<h2>Wrapping up</h2>
<p>All right, that&#x27;s all for now! Remember that these by any means aren&#x27;t rules but rather signs that something <em>might</em> be &quot;wrong&quot;. You&#x27;ll definitely run into situations where you want to do some of the things above for good reason.</p>
<p>Got any feedback on why I&#x27;m <em>very wrong</em> about this? Suggestions for other code smells that you&#x27;ve stumbled upon in your components? Hit me up on <a href="https://twitter.com/awnton">Twitter</a>!</p>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[React renderers]]></title>
        <id>https://antongunnarsson.com/posts/react-renderers</id>
        <link href="https://antongunnarsson.com/posts/react-renderers"/>
        <updated>2020-08-22T20:17:00.000Z</updated>
        <content type="html"><![CDATA[<p>Live notes on creating a custom renderer in React.</p>
<h2>Creating a renderer</h2>
<p>To create a React <code>renderer</code> you implement the <a href="https://github.com/facebook/react/tree/master/packages/react-reconciler"><code>react-reconciler</code></a> package:</p>
<ul>
<li><a href="https://twitter.com/vadimdemedes/status/1277620575058505728">https://twitter.com/vadimdemedes/status/1277620575058505728</a></li>
<li><a href="https://blog.atulr.com/react-custom-renderer-1/">https://blog.atulr.com/react-custom-renderer-1/</a></li>
<li><a href="https://github.com/doodlewind/react-ssd1306/blob/master/docs/tutorial.md">https://github.com/doodlewind/react-ssd1306/blob/master/docs/tutorial.md</a></li>
<li><a href="https://github.com/nitin42/Making-a-custom-React-renderer">https://github.com/nitin42/Making-a-custom-React-renderer</a></li>
</ul>
<h2>Renderer vs reconciler</h2>
<p>Sometimes <code>renderers</code> are incorrectly called <code>reconcilers</code> but reconciliation and rendering are separate things. The reconciler (which is React internal) determines which part of a tree has changed, while renderers use the reconciled tree to render the app. (<a href="https://github.com/acdlite/react-fiber-architecture#reconciliation-versus-rendering">1</a>, <a href="https://twitter.com/dan_abramov/status/1286008969429954560">2</a>, <a href="https://reactjs.org/docs/reconciliation.html">3</a>)</p>
<h2>A few renderers</h2>
<ul>
<li><a href="https://github.com/facebook/react/tree/master/packages/react-dom">react-dom</a>: renders components to the DOM.</li>
<li><a href="https://github.com/facebook/react/tree/master/packages/react-native-renderer">react-native-renderer</a>: renders components to native views.</li>
<li><a href="https://github.com/vadimdemedes/ink">ink</a>: renders components to the command-line.</li>
<li><a href="https://github.com/react-spring/react-three-fiber">react-three-fiber</a>: renders <a href="https://threejs.org/">three.js</a> in a React environment.</li>
</ul>
<p>More reading:</p>
<ul>
<li><a href="https://github.com/chentsulin/awesome-react-renderer">https://github.com/chentsulin/awesome-react-renderer</a></li>
<li><a href="https://reactjs.org/docs/codebase-overview.html#renderers">https://reactjs.org/docs/codebase-overview.html#renderers</a></li>
</ul>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Recursive components]]></title>
        <id>https://antongunnarsson.com/posts/recursive-components</id>
        <link href="https://antongunnarsson.com/posts/recursive-components"/>
        <updated>2020-01-16T20:17:00.000Z</updated>
        <content type="html"><![CDATA[<p>I always had a hard time understanding recursive <em>functions</em> when I stumbled upon them while learning to code. While I&#x27;ve got a better understanding today I don&#x27;t use them much since they most often make the code harder to read and reason about. One place I do use recursion however is when implementing recursive components.</p>
<p>In this post we&#x27;ll touch on what recursion is, why recursive components are pretty cool for solving certain kind of problems and implement one that renders a folder structure like this:</p>
<ul class="Folders__List-sc-2b9f64af-0 jVNMJk"><li style="margin-top:4px"><button style="width:22px;padding:2px;border-radius:5px;border:1px solid lightgray;color:var(--color-text);margin:0;background-color:transparent;line-height:1">-</button><span class="mdx" style="padding-left:6px">Desktop folder</span><ul style="margin:4px 10px;box-sizing:border-box;list-style:none;padding-left:20px;border-left:1px dashed lightgray"><li style="margin-top:4px"><button style="width:22px;padding:2px;border-radius:5px;border:1px solid lightgray;color:var(--color-text);margin:0;background-color:transparent;line-height:1">-</button><span class="mdx" style="padding-left:6px">Pics</span><ul style="margin:4px 10px;box-sizing:border-box;list-style:none;padding-left:20px;border-left:1px dashed lightgray"><li style="margin-top:4px"><span class="mdx" style="padding-left:0px">Cats</span></li></ul></li><li style="margin-top:4px"><button style="width:22px;padding:2px;border-radius:5px;border:1px solid lightgray;color:var(--color-text);margin:0;background-color:transparent;line-height:1">-</button><span class="mdx" style="padding-left:6px">Important stuff</span><ul style="margin:4px 10px;box-sizing:border-box;list-style:none;padding-left:20px;border-left:1px dashed lightgray"><li style="margin-top:4px"><span class="mdx" style="padding-left:0px">Memes</span></li><li style="margin-top:4px"><span class="mdx" style="padding-left:0px">Funny pics</span></li></ul></li><li style="margin-top:4px"><span class="mdx" style="padding-left:0px">Blog post drafts</span></li></ul></li></ul>
<div class="Callout__Wrapper-sc-ecc76565-0 ibhdIn"><p>While we will use React to implement this component it&#x27;s possible to build recursive components in all other modern JS frameworks too.</p></div>
<p>Before we get started, let&#x27;s talk just a little bit about recursion. Feel free to skip ahead if you got a good grasp on it already.</p>
<p>So what is recursion really? <a href="https://en.wikipedia.org/wiki/Recursion_(computer_science)">Wikipedia</a> defines it as <em>&quot;a method of solving a problem where the solution depends on solutions to smaller instances of the same problem.&quot;</em>. In reality, this often translates to problems where hierarchical structures like trees are involved.</p>
<p><span style="box-sizing:border-box;display:block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;padding-top:97.39413680781759%"></span><img alt="A visualization of a tree structure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="A visualization of a tree structure" sizes="100vw" srcSet="/_next/image?url=%2Ftree.png&amp;w=640&amp;q=75 640w, /_next/image?url=%2Ftree.png&amp;w=750&amp;q=75 750w, /_next/image?url=%2Ftree.png&amp;w=828&amp;q=75 828w, /_next/image?url=%2Ftree.png&amp;w=1080&amp;q=75 1080w, /_next/image?url=%2Ftree.png&amp;w=1200&amp;q=75 1200w, /_next/image?url=%2Ftree.png&amp;w=1920&amp;q=75 1920w, /_next/image?url=%2Ftree.png&amp;w=2048&amp;q=75 2048w, /_next/image?url=%2Ftree.png&amp;w=3840&amp;q=75 3840w" src="https://antongunnarsson.com/_next/image?url=%2Ftree.png&amp;w=3840&amp;q=75" decoding="async" data-nimg="responsive" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p>
<p>So a recursive function is a function that invokes itself. In the case of traversing the above tree, we would have a function <code>traverse(node)</code> that we&#x27;d invoke for the root of the tree, and then it would invoke itself for every child. So first <code>traverse(A)</code>, then <code>traverse(B)</code> and then those would invoke the function on their children and so on.</p>
<p>A recursive component, on the other hand, is a component that renders itself. One place where this comes in handy is when implementing features that deal with tree-like data, for example, a nested menu, comments with a hierarchy or as we&#x27;ll implement in this post; a component that displays a folder structure.</p>
<p>The only important part of recursion we need to keep track of in our implementation of a recursive component is <strong>the base case</strong>. This is the case when we need to break out of the recursion and stop rendering ourself, otherwise we&#x27;d be stuck in an infinite loop. We&#x27;ll get back to this is just a second.</p>
<p>Let&#x27;s get to building the component. The data for the folder structure looks like this:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="json" data-theme="default"><span class="line"><span style="color:#000000">{</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0451A5">&quot;name&quot;</span><span style="color:#000000">: </span><span style="color:#A31515">&quot;Desktop folder&quot;</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0451A5">&quot;children&quot;</span><span style="color:#000000">: [</span></span>
<span class="line"><span style="color:#000000">    {</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#0451A5">&quot;name&quot;</span><span style="color:#000000">: </span><span style="color:#A31515">&quot;Pics&quot;</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#0451A5">&quot;children&quot;</span><span style="color:#000000">: [</span></span>
<span class="line"><span style="color:#000000">        {</span></span>
<span class="line"><span style="color:#000000">          </span><span style="color:#0451A5">&quot;name&quot;</span><span style="color:#000000">: </span><span style="color:#A31515">&quot;Cats&quot;</span></span>
<span class="line"><span style="color:#000000">        }</span></span>
<span class="line"><span style="color:#000000">      ]</span></span>
<span class="line"><span style="color:#000000">    },</span></span>
<span class="line"><span style="color:#000000">    {</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#0451A5">&quot;name&quot;</span><span style="color:#000000">: </span><span style="color:#A31515">&quot;Important stuff&quot;</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#0451A5">&quot;children&quot;</span><span style="color:#000000">: [</span></span>
<span class="line"><span style="color:#000000">        {</span></span>
<span class="line"><span style="color:#000000">          </span><span style="color:#0451A5">&quot;name&quot;</span><span style="color:#000000">: </span><span style="color:#A31515">&quot;Memes&quot;</span></span>
<span class="line"><span style="color:#000000">        },</span></span>
<span class="line"><span style="color:#000000">        {</span></span>
<span class="line"><span style="color:#000000">          </span><span style="color:#0451A5">&quot;name&quot;</span><span style="color:#000000">: </span><span style="color:#A31515">&quot;Funny pics&quot;</span></span>
<span class="line"><span style="color:#000000">        }</span></span>
<span class="line"><span style="color:#000000">      ]</span></span>
<span class="line"><span style="color:#000000">    },</span></span>
<span class="line"><span style="color:#000000">    {</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#0451A5">&quot;name&quot;</span><span style="color:#000000">: </span><span style="color:#A31515">&quot;Blog post drafts&quot;</span></span>
<span class="line"><span style="color:#000000">    }</span></span>
<span class="line"><span style="color:#000000">  ]</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>We&#x27;ll start by creating a new component called <code>Folder</code> that will take a single prop called <code>folder</code>. It will render the name of the folder and then render itself (ie the same component) for each of its children.</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#AF00DB">import</span><span style="color:#000000"> </span><span style="color:#001080">React</span><span style="color:#000000"> </span><span style="color:#AF00DB">from</span><span style="color:#000000"> </span><span style="color:#A31515">&#x27;react&#x27;</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#AF00DB">export</span><span style="color:#000000"> </span><span style="color:#AF00DB">default</span><span style="color:#000000"> </span><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">Folder</span><span style="color:#000000">({ </span><span style="color:#001080">folder</span><span style="color:#000000"> }) {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> (</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#800000">&lt;li&gt;</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#0000FF">{</span><span style="color:#001080">folder</span><span style="color:#000000FF">.</span><span style="color:#001080">name</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#0000FF">{</span><span style="color:#001080">folder</span><span style="color:#000000FF">.</span><span style="color:#001080">children</span><span style="color:#000000FF">.</span><span style="color:#795E26">map</span><span style="color:#000000FF">((</span><span style="color:#001080">child</span><span style="color:#000000FF">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000FF"> (</span></span>
<span class="line"><span style="color:#000000FF">        </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Folder</span><span style="color:#000000FF"> </span><span style="color:#FF0000">folder</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">child</span><span style="color:#0000FF">}</span><span style="color:#800000">&gt;&lt;/</span><span style="color:#267F99">Folder</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000FF">      ))</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#800000">&lt;/li&gt;</span></span>
<span class="line"><span style="color:#000000">  )</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>The one thing missing from this is that we need to identify our base case so that we can break out of the recursion. In our case, this will be when the folder has no children, or in other words, when it&#x27;s a <em>leaf</em> in our tree. Let&#x27;s add a conditional that checks just this.</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#AF00DB">import</span><span style="color:#000000"> </span><span style="color:#001080">React</span><span style="color:#000000"> </span><span style="color:#AF00DB">from</span><span style="color:#000000"> </span><span style="color:#A31515">&#x27;react&#x27;</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#AF00DB">export</span><span style="color:#000000"> </span><span style="color:#AF00DB">default</span><span style="color:#000000"> </span><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">Folder</span><span style="color:#000000">({ </span><span style="color:#001080">folder</span><span style="color:#000000"> }) {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">isLeaf</span><span style="color:#000000"> = !</span><span style="color:#001080">folder</span><span style="color:#000000">.</span><span style="color:#001080">children</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> (</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#800000">&lt;li&gt;</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#0000FF">{</span><span style="color:#001080">folder</span><span style="color:#000000FF">.</span><span style="color:#001080">name</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#0000FF">{</span><span style="color:#000000">!</span><span style="color:#001080">isLeaf</span><span style="color:#000000FF"> </span><span style="color:#000000">&amp;&amp;</span><span style="color:#000000FF"> </span><span style="color:#001080">folder</span><span style="color:#000000FF">.</span><span style="color:#001080">children</span><span style="color:#000000FF">.</span><span style="color:#795E26">map</span><span style="color:#000000FF">((</span><span style="color:#001080">child</span><span style="color:#000000FF">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000FF"> </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Folder</span><span style="color:#000000FF"> </span><span style="color:#FF0000">folder</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">child</span><span style="color:#0000FF">}</span><span style="color:#800000">&gt;&lt;/</span><span style="color:#267F99">Folder</span><span style="color:#800000">&gt;</span><span style="color:#000000FF">)</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#800000">&lt;/li&gt;</span></span>
<span class="line"><span style="color:#000000">  )</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>Finally we render the <code>&lt;Folder /&gt;</code> component somewhere:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#800000">&lt;ul&gt;</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Folder</span><span style="color:#000000"> </span><span style="color:#FF0000">folder</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">data</span><span style="color:#0000FF">}</span><span style="color:#800000">&gt;&lt;/</span><span style="color:#267F99">Folder</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#800000">&lt;/ul&gt;</span></span></code></pre></div>
<p>And that&#x27;s it! You&#x27;ve just created a component that recursively renders itself until it reaches its base case. If you&#x27;d like you can now add some better styling, expand/collapse buttons or try implementing it a recursive comment structure. You can find the complete source to the example at the top in this <a href="https://codesandbox.io/s/mutable-firefly-tnjfs?fontsize=14&amp;hidenavigation=1&amp;theme=dark">CodeSandbox</a>.</p>
<p>Thanks for reading! ðŸ™Œ</p>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Remote-friendly games]]></title>
        <id>https://antongunnarsson.com/posts/remote-friendly-games</id>
        <link href="https://antongunnarsson.com/posts/remote-friendly-games"/>
        <updated>2022-01-26T18:12:00.000Z</updated>
        <content type="html"><![CDATA[<p>I find that in-person meetings and afterworks benefit the team culture incredibly much. It doesn&#x27;t have to be a very long meeting, a late afterwork or many (or few) people, I&#x27;ve found that they do <em>so much</em> for team spirit regardless. There&#x27;s much more to be said about this but in this new era of pandemic home work I&#x27;ve tried to recreate some of this in-person magic by playing games toghether remotely.</p>
<p>So here are some tried and tested games that are fun and also work very well to play in a virtual setting:</p>
<h2>Scribbl.io</h2>
<p><a href="https://scribbl.io">Scribbl.io</a> is an online take on the classic game (eg Pictionary) where one person draws a motif and the rest of the players have to guess what it is.</p>
<p><em>(Free with ads)</em></p>
<h2>Gartic Phone</h2>
<p>A game without a winner, <a href="https://garticphone.com">Gartic Phone</a> is the &quot;telephone&quot; game (or <a href="https://en.wikipedia.org/wiki/Chinese_whispers">&quot;Chinese Whispers&quot; and many others</a>) brought online. Every player alternates between drawing and guessing what the drawings represents which in the end results in a often silly chain of drawings <em>slighty</em> changing meaning. Gartic Phone also comes with other modes such as speedrun, animation, secret and more.</p>
<p><em>(Free with ads)</em></p>
<h2>draw.wtf</h2>
<p>Small and shameless self promotion of my game <a href="https://draw.wtf">draw.wtf</a>. It&#x27;s a silly drawing game where every round consists of everyone drawing a random motif with the goal of receiving the highest score from a (somewhat shitty) AI. Actually really fun, just ask my team! :)</p>
<p><em>(Free)</em></p>
<h2>Kahoot!</h2>
<p><a href="http://kahoot.com">Kahoot</a> is the go-to service for hosting online quizes. There&#x27;s lots of premade quizes, but it&#x27;s definitely most fun if you create one yourself. One favorite of mine is asking your team members to send you a photo of their fridge and then let the team guess whos fridge is whos (works great without Kahoot as well!).</p>
<p><em>(Free with paid options)</em></p>
<h2>Geotastic</h2>
<p><a href="https://geotastic.net">Geotastic</a> is a free alternative to Geoguessr, the game where you are dropped somewhere in the world inside the Google Street View and just by looking at the environment around you have to find out where you are. It&#x27;s incredibly fun to split the team in two and compete against each other to see who can score the highest.</p>
<p><em>(Free)</em></p>
<h2>Krunker</h2>
<p>Maybe not quite as accessible as the others but <a href="https://krunker.io">Krunker</a> is great fun for the gamers in the team. A completely web based first-person shooter which is very easy to get started with.</p>
<p><em>(Free)</em></p>
<h2>Among Us</h2>
<p>The sleeper hit of 2020. <a href="https://www.innersloth.com/games/among-us/">Among Us</a> is a modern take on games like Werewolf or Maffia where one (or several) player is a traitor trying to kill the others. The fact that you can only talk during certain meetings definitely takes this to the next level.</p>
<p><em>(Free on mobile)</em></p>
<h3>That&#x27;s it for now!</h3>
<p>Got any more remote friendly games that I&#x27;ve missed? Please <a href="https://twitter.com/awnton">let me know!</a></p>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Render props in the Age of Hooks]]></title>
        <id>https://antongunnarsson.com/posts/render-props</id>
        <link href="https://antongunnarsson.com/posts/render-props"/>
        <updated>2020-05-18T09:30:00.000Z</updated>
        <content type="html"><![CDATA[<p>Through the years many different patterns have emerged to solve problems we encounter writing React components. One of the most popular patterns ever is the <code>render prop</code>-pattern.</p>
<p>In this post, we&#x27;ll walk through what render props are, what the implementation looks like, and how they fit into the React landscape now that we live in <em>the Golden Age of Hooks</em>. Let&#x27;s get started!</p>
<div class="Callout__Wrapper-sc-ecc76565-0 ibhdIn"><p>If you know what render props are but are curious about its current use cases, feel free to <a href="#in-the-age-of-hooks">skip ahead!</a></p></div>
<h2>So what is a render prop?</h2>
<p>In theory, a render prop is a way to share common functionality. It follows a principle called <a href="https://kentcdodds.com/blog/inversion-of-control">&quot;Inversion of Control&quot;</a> which is a way to move control from the abstraction to the user of said abstraction.</p>
<p>Wait.. what?</p>
<p>Yeah, I know. Let&#x27;s take a look at a <em>very</em> simplified example instead of talking theory.</p>
<p>This is a small component that renders a button and when you click that button you increase the count by one.</p>
<div class="RenderPropsCounter__Wrapper-sc-dc14b6b7-0 cwrgSd"><h1>Click it, I&#x27;m interactive!</h1><button>Increase count</button><p>0</p></div>
<p>The implementation looks like this:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#AF00DB">export</span><span style="color:#000000"> </span><span style="color:#AF00DB">default</span><span style="color:#000000"> </span><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">Counter</span><span style="color:#000000">() {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> [</span><span style="color:#0070C1">count</span><span style="color:#000000">, </span><span style="color:#0070C1">setCount</span><span style="color:#000000">] = </span><span style="color:#795E26">useState</span><span style="color:#000000">(</span><span style="color:#098658">0</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> (</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#800000">&lt;div&gt;</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#800000">&lt;h1&gt;</span><span style="color:#000000">Click it, I&#x27;m interactive!</span><span style="color:#800000">&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#800000">&lt;button</span><span style="color:#000000"> </span><span style="color:#FF0000">onClick</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#000000FF">() </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000FF"> </span><span style="color:#795E26">setCount</span><span style="color:#000000FF">((</span><span style="color:#001080">c</span><span style="color:#000000FF">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000FF"> </span><span style="color:#001080">c</span><span style="color:#000000FF"> </span><span style="color:#000000">+</span><span style="color:#000000FF"> </span><span style="color:#098658">1</span><span style="color:#000000FF">)</span><span style="color:#0000FF">}</span><span style="color:#800000">&gt;</span><span style="color:#000000">Increase count</span><span style="color:#800000">&lt;/button&gt;</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#800000">&lt;p&gt;</span><span style="color:#0000FF">{</span><span style="color:#001080">count</span><span style="color:#0000FF">}</span><span style="color:#800000">&lt;/p&gt;</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#800000">&lt;/div&gt;</span></span>
<span class="line"><span style="color:#000000">  )</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>Now, for the sake of the example let&#x27;s say we want to give the user more control of how the number is displayed. The first thought might be to add a prop to the component to add some styling. That would work if we just wanna change the styling, but what if we run into a situation where we also want to wrap the count in some text? While we could add another prop for this it&#x27;s also a perfect time to try using a render prop.</p>
<p>Imagining we want to add some styling and then display the count like &quot;<code>The count is X!</code>&quot; we can move this control to the consumer of the component by refactoring our component to this:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line highlighted"><span style="color:#AF00DB">export</span><span style="color:#000000"> </span><span style="color:#AF00DB">default</span><span style="color:#000000"> </span><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">Counter</span><span style="color:#000000">({ </span><span style="color:#001080">renderCount</span><span style="color:#000000"> }) {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> [</span><span style="color:#0070C1">count</span><span style="color:#000000">, </span><span style="color:#0070C1">setCount</span><span style="color:#000000">] = </span><span style="color:#795E26">useState</span><span style="color:#000000">(</span><span style="color:#098658">0</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> (</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#800000">&lt;div&gt;</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#800000">&lt;h1&gt;</span><span style="color:#000000">Click it, I&#x27;m interactive!</span><span style="color:#800000">&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#800000">&lt;button</span><span style="color:#000000"> </span><span style="color:#FF0000">onClick</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#000000FF">() </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000FF"> </span><span style="color:#795E26">setCount</span><span style="color:#000000FF">((</span><span style="color:#001080">c</span><span style="color:#000000FF">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000FF"> </span><span style="color:#001080">c</span><span style="color:#000000FF"> </span><span style="color:#000000">+</span><span style="color:#000000FF"> </span><span style="color:#098658">1</span><span style="color:#000000FF">)</span><span style="color:#0000FF">}</span><span style="color:#800000">&gt;</span><span style="color:#000000">Increase count</span><span style="color:#800000">&lt;/button&gt;</span></span>
<span class="line highlighted"><span style="color:#000000">      </span><span style="color:#800000">&lt;p&gt;</span><span style="color:#0000FF">{</span><span style="color:#795E26">renderCount</span><span style="color:#000000FF">(</span><span style="color:#001080">count</span><span style="color:#000000FF">)</span><span style="color:#0000FF">}</span><span style="color:#800000">&lt;/p&gt;</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#800000">&lt;/div&gt;</span></span>
<span class="line"><span style="color:#000000">  )</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>Now our component receives a prop called <code>renderCount</code> which we expect to be a function. We then invoke this function on line 8 passing it the current count.</p>
<p>And here is how we now use this component:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#800000">&lt;</span><span style="color:#267F99">Counter</span><span style="color:#000000"> </span><span style="color:#FF0000">renderCount</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#000000FF">(</span><span style="color:#001080">count</span><span style="color:#000000FF">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000FF"> </span><span style="color:#800000">&lt;span&gt;</span><span style="color:#000000FF">The count is </span><span style="color:#0000FF">{</span><span style="color:#001080">count</span><span style="color:#0000FF">}</span><span style="color:#000000FF">!</span><span style="color:#800000">&lt;/span&gt;</span><span style="color:#0000FF">}</span><span style="color:#000000"> </span><span style="color:#800000">/&gt;</span></span></code></pre></div>
<p>We pass in the <code>renderCount</code> prop as an arrow function that receives the count and returns a span with our desired text. (Note that the prop <code>renderCount</code> could be called anything.)</p>
<p>And now our component looks like this:</p>
<div class="RenderPropsCounter__Wrapper-sc-dc14b6b7-0 cwrgSd"><h1>Click it, I&#x27;m interactive!</h1><button>Increase count</button><p><span>The count is 0!</span></p></div>
<p>By doing this we&#x27;ve <em>inverted</em> the control of rendering the count from the component itself to the consumer of the component.</p>
<h3>Function as children</h3>
<p>Before moving on to why render props aren&#x27;t as widely used anymore and in which cases they might still be relevant, I just want to mention the concept of <code>function as children</code>. While React doesn&#x27;t support passing a function as a child of a component and rendering it, you can use it together with render props since children are just a prop.</p>
<p>Refactoring our component once again we end up with this:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line highlighted"><span style="color:#AF00DB">export</span><span style="color:#000000"> </span><span style="color:#AF00DB">default</span><span style="color:#000000"> </span><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">Counter</span><span style="color:#000000">({ </span><span style="color:#001080">children</span><span style="color:#000000"> }) {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> [</span><span style="color:#0070C1">count</span><span style="color:#000000">, </span><span style="color:#0070C1">setCount</span><span style="color:#000000">] = </span><span style="color:#795E26">useState</span><span style="color:#000000">(</span><span style="color:#098658">0</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> (</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#800000">&lt;div&gt;</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#800000">&lt;h1&gt;</span><span style="color:#000000">Click it, I&#x27;m interactive!</span><span style="color:#800000">&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#800000">&lt;button</span><span style="color:#000000"> </span><span style="color:#FF0000">onClick</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#000000FF">() </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000FF"> </span><span style="color:#795E26">setCount</span><span style="color:#000000FF">((</span><span style="color:#001080">c</span><span style="color:#000000FF">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000FF"> </span><span style="color:#001080">c</span><span style="color:#000000FF"> </span><span style="color:#000000">+</span><span style="color:#000000FF"> </span><span style="color:#098658">1</span><span style="color:#000000FF">)</span><span style="color:#0000FF">}</span><span style="color:#800000">&gt;</span><span style="color:#000000">Increase count</span><span style="color:#800000">&lt;/button&gt;</span></span>
<span class="line highlighted"><span style="color:#000000">      </span><span style="color:#800000">&lt;p&gt;</span><span style="color:#0000FF">{</span><span style="color:#795E26">children</span><span style="color:#000000FF">(</span><span style="color:#001080">count</span><span style="color:#000000FF">)</span><span style="color:#0000FF">}</span><span style="color:#800000">&lt;/p&gt;</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#800000">&lt;/div&gt;</span></span>
<span class="line"><span style="color:#000000">  )</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>This looks very similar to before, we&#x27;ve just removed our custom prop and now uses the reserved <code>children</code> prop instead and hence we pass the function down as the child:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#800000">&lt;</span><span style="color:#267F99">Counter</span><span style="color:#800000">&gt;</span><span style="color:#0000FF">{</span><span style="color:#000000FF">(</span><span style="color:#001080">count</span><span style="color:#000000FF">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000FF"> </span><span style="color:#800000">&lt;span&gt;</span><span style="color:#000000FF">The count is </span><span style="color:#0000FF">{</span><span style="color:#001080">count</span><span style="color:#0000FF">}</span><span style="color:#000000FF">!</span><span style="color:#800000">&lt;/span&gt;</span><span style="color:#0000FF">}</span><span style="color:#800000">&lt;/</span><span style="color:#267F99">Counter</span><span style="color:#800000">&gt;</span></span></code></pre></div>
<p>I had a really hard time wrapping my head around this syntax when I first learned about render props, but it&#x27;s also the most popular way of using them so it&#x27;s likely you&#x27;ll encounter it too.</p>
<div class="Callout__Wrapper-sc-ecc76565-0 ibhdIn"><p>In reality, it&#x27;s more likely you&#x27;ll encounter components that use render props to handle tracking mouse movement, scrolling or similar things.</p></div>
<h2>Drawbacks</h2>
<p>While render props might sound great there are a couple of issues that I want to talk about.</p>
<p>One problem is that when you get to a point where you need to use multiple components with a render prop api you could end up in what you might recognize as <em>&quot;the pyramid of death&quot;</em>. Below is an example where we have a component that needs access to its measured size, the scroll position, mouse position, and some styling for animation purposes:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#800000">&lt;</span><span style="color:#267F99">Mouse</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">{</span><span style="color:#000000FF">(</span><span style="color:#001080">mouse</span><span style="color:#000000FF">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000FF"> (</span></span>
<span class="line"><span style="color:#000000FF">    </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Scroll</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000FF">      </span><span style="color:#0000FF">{</span><span style="color:#000000FF">(</span><span style="color:#001080">scroll</span><span style="color:#000000FF">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000FF"> (</span></span>
<span class="line"><span style="color:#000000FF">        </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Motion</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000FF">          </span><span style="color:#0000FF">{</span><span style="color:#000000FF">(</span><span style="color:#001080">style</span><span style="color:#000000FF">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000FF"> (</span></span>
<span class="line"><span style="color:#000000FF">            </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Measure</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000FF">              </span><span style="color:#0000FF">{</span><span style="color:#000000FF">(</span><span style="color:#001080">size</span><span style="color:#000000FF">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000FF"> (</span></span>
<span class="line"><span style="color:#000000FF">                </span><span style="color:#800000">&lt;</span><span style="color:#267F99">ConsumingComponent</span><span style="color:#000000FF"> </span><span style="color:#FF0000">mouse</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">mouse</span><span style="color:#0000FF">}</span><span style="color:#000000FF"> </span><span style="color:#FF0000">scroll</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">scroll</span><span style="color:#0000FF">}</span><span style="color:#000000FF"> </span><span style="color:#FF0000">style</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">style</span><span style="color:#0000FF">}</span><span style="color:#000000FF"> </span><span style="color:#FF0000">size</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">size</span><span style="color:#0000FF">}</span><span style="color:#800000">&gt;&lt;/</span><span style="color:#267F99">ConsumingComponent</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000FF">              )</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#000000FF">            </span><span style="color:#800000">&lt;/</span><span style="color:#267F99">Measure</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000FF">          )</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#000000FF">        </span><span style="color:#800000">&lt;/</span><span style="color:#267F99">Motion</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000FF">      )</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#000000FF">    </span><span style="color:#800000">&lt;/</span><span style="color:#267F99">Scroll</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000FF">  )</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#800000">&lt;/</span><span style="color:#267F99">Mouse</span><span style="color:#800000">&gt;</span></span></code></pre></div>
<p>Comparing this to a pseudo-code version using Hooks you can see why a lot of people prefer Hooks:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">mouse</span><span style="color:#000000"> = </span><span style="color:#795E26">useMouse</span><span style="color:#000000">()</span></span>
<span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">scroll</span><span style="color:#000000"> = </span><span style="color:#795E26">useScroll</span><span style="color:#000000">()</span></span>
<span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">style</span><span style="color:#000000"> = </span><span style="color:#795E26">useMotion</span><span style="color:#000000">()</span></span>
<span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">size</span><span style="color:#000000"> = </span><span style="color:#795E26">useMeasure</span><span style="color:#000000">()</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;</span><span style="color:#267F99">ConsumingComponent</span><span style="color:#000000"> </span><span style="color:#FF0000">mouse</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">mouse</span><span style="color:#0000FF">}</span><span style="color:#000000"> </span><span style="color:#FF0000">scroll</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">scroll</span><span style="color:#0000FF">}</span><span style="color:#000000"> </span><span style="color:#FF0000">style</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">style</span><span style="color:#0000FF">}</span><span style="color:#000000"> </span><span style="color:#FF0000">size</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">size</span><span style="color:#0000FF">}</span><span style="color:#000000"> </span><span style="color:#800000">/&gt;</span></span></code></pre></div>
<p>Another thing that this example illustrates is that we get a much clearer separation between rendering and preparing to render. In the render prop-example we don&#x27;t care about the <code>&lt;Mouse&gt;</code> component, we just care about the value we get in the render prop function.</p>
<p>This also means that if need to use or process the values returned by our hooks we don&#x27;t need to have this logic mixed with what we return. This separation is so much clearer in comparison to render props which I think is very good.</p>
<h2><a name="in-the-age-of-hooks"></a> In the Age of Hooks</h2>
<p>When Hooks were introduced back in 2018 I can&#x27;t say that the community screamed with joy. The reaction was mostly complaining about this completely new thing that we&#x27;ll also have to learn. Yet here we are two years later and most of the hate has died down and modern React is now mostly defined by Hooks. This has also meant that the render prop pattern isn&#x27;t as popular as it was just a couple of years ago. But while hooks are superior to render props in most cases there are still a couple of situations where you might want to reach for a good ol&#x27; render prop.</p>
<h3>Wrapping hooks</h3>
<p>One of the most straight forward use cases for render props is to wrap hooks so you can use them in class components. Let&#x27;s say we&#x27;ve previously used a render prop to track whether the mouse is hovering an element and now we refactor this to a <a href="https://usehooks.com/useHover/"><code>useHover</code></a> hook instead. To use this in a class component we can wrap it in a render prop:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">Hover</span><span style="color:#000000">({ </span><span style="color:#001080">children</span><span style="color:#000000"> }) {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#795E26">children</span><span style="color:#000000">(</span><span style="color:#795E26">useHover</span><span style="color:#000000">())</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>And then we can use it in a class component just like we would if <code>Hover</code> took care of the implementation itself:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">class</span><span style="color:#000000"> </span><span style="color:#267F99">MyComponent</span><span style="color:#000000"> </span><span style="color:#0000FF">extends</span><span style="color:#000000"> </span><span style="color:#267F99">React</span><span style="color:#000000">.</span><span style="color:#267F99">Component</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#795E26">render</span><span style="color:#000000">() {</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#AF00DB">return</span><span style="color:#000000"> (</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Hover</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000">        </span><span style="color:#0000FF">{</span><span style="color:#000000FF">([</span><span style="color:#001080">hoverRef</span><span style="color:#000000FF">, </span><span style="color:#001080">isHovered</span><span style="color:#000000FF">]) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000FF"> {</span></span>
<span class="line"><span style="color:#000000FF">          </span><span style="color:#AF00DB">return</span><span style="color:#000000FF"> </span><span style="color:#800000">&lt;div</span><span style="color:#000000FF"> </span><span style="color:#FF0000">ref</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">hoverRef</span><span style="color:#0000FF">}</span><span style="color:#800000">&gt;</span><span style="color:#0000FF">{</span><span style="color:#001080">isHovered</span><span style="color:#000000FF"> </span><span style="color:#000000">?</span><span style="color:#000000FF"> </span><span style="color:#A31515">&#x27;ðŸ˜ƒ&#x27;</span><span style="color:#000000FF"> </span><span style="color:#000000">:</span><span style="color:#000000FF"> </span><span style="color:#A31515">&#x27;ðŸ˜ž&#x27;</span><span style="color:#0000FF">}</span><span style="color:#800000">&lt;/div&gt;</span></span>
<span class="line"><span style="color:#000000FF">        }</span><span style="color:#0000FF">}</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#800000">&lt;/</span><span style="color:#267F99">Hover</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000">    )</span></span>
<span class="line"><span style="color:#000000">  }</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>Pretty neat, right?</p>
<h3>Enable custom rendering</h3>
<p>In the below example we have a component called <code>Grid</code> that takes a prop called data. It renders a table with two rows and two columns, and handles the logic for sorting, filtering, rearranging columns and so on.</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">data</span><span style="color:#000000"> = [</span></span>
<span class="line"><span style="color:#000000">  {</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#001080">name:</span><span style="color:#000000"> </span><span style="color:#A31515">&#x27;Anton&#x27;</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#001080">age:</span><span style="color:#000000"> </span><span style="color:#098658">28</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">  },</span></span>
<span class="line"><span style="color:#000000">  {</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#001080">name:</span><span style="color:#000000"> </span><span style="color:#A31515">&#x27;Nisse&#x27;</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#001080">age:</span><span style="color:#000000"> </span><span style="color:#098658">32</span><span style="color:#000000">,</span></span>
<span class="line"><span style="color:#000000">  },</span></span>
<span class="line"><span style="color:#000000">]</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Grid</span><span style="color:#000000"> </span><span style="color:#FF0000">data</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">data</span><span style="color:#0000FF">}</span><span style="color:#000000"> </span><span style="color:#800000">/&gt;</span></span></code></pre></div>
<p>Now imagine that we need to change how a row or cell is displayed. This is a perfect opportunity to implement two render props in the component that defers this rendering to the user:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#800000">&lt;</span><span style="color:#267F99">Grid</span><span style="color:#000000"> </span><span style="color:#FF0000">data</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">data</span><span style="color:#0000FF">}</span><span style="color:#000000"> </span><span style="color:#FF0000">rowRenderer</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#000000FF">(</span><span style="color:#001080">row</span><span style="color:#000000FF">, </span><span style="color:#001080">idx</span><span style="color:#000000FF">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000FF"> </span><span style="color:#800000">&lt;div&gt;</span><span style="color:#000000FF">...</span><span style="color:#800000">&lt;/div&gt;</span><span style="color:#0000FF">}</span><span style="color:#000000"> </span><span style="color:#FF0000">cellRenderer</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#000000FF">(</span><span style="color:#001080">cell</span><span style="color:#000000FF">, </span><span style="color:#001080">row</span><span style="color:#000000FF">, </span><span style="color:#001080">idx</span><span style="color:#000000FF">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000FF"> </span><span style="color:#800000">&lt;div&gt;</span><span style="color:#000000FF">...</span><span style="color:#800000">&lt;/div&gt;</span><span style="color:#0000FF">}</span><span style="color:#000000"> </span><span style="color:#800000">/&gt;</span></span></code></pre></div>
<p>This could be implemented with a hook that takes the renderers as arguments, but in this case I believe the render prop api is much more pleasant to work with.</p>
<h3>Performance</h3>
<p>Finally, I recently watched a talk by <a href="https://twitter.com/erikras">@erikras</a> and learned about a third use case when you might want to use render props. Below is a component that uses the previously mentioned <code>useHover</code> hook, but it also renders a component called <code>VerySlowToRender</code> which is, well.. very slow to render. It&#x27;s probably from a third-party package that you have no control over but for some reason you still have to use it.</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">MyComponent</span><span style="color:#000000">() {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> [</span><span style="color:#0070C1">hoverRef</span><span style="color:#000000">, </span><span style="color:#0070C1">isHovered</span><span style="color:#000000">] = </span><span style="color:#795E26">useHover</span><span style="color:#000000">()</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> (</span></span>
<span class="line highlighted"><span style="color:#000000">    </span><span style="color:#800000">&lt;</span><span style="color:#267F99">VerySlowToRender</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000">      </span><span style="color:#800000">&lt;div</span><span style="color:#000000"> </span><span style="color:#FF0000">ref</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">hoverRef</span><span style="color:#0000FF">}</span><span style="color:#800000">&gt;</span><span style="color:#0000FF">{</span><span style="color:#001080">isHovered</span><span style="color:#000000FF"> </span><span style="color:#000000">?</span><span style="color:#000000FF"> </span><span style="color:#A31515">&#x27;ðŸ˜ƒ&#x27;</span><span style="color:#000000FF"> </span><span style="color:#000000">:</span><span style="color:#000000FF"> </span><span style="color:#A31515">&#x27;ðŸ˜ž&#x27;</span><span style="color:#0000FF">}</span><span style="color:#800000">&lt;/div&gt;</span></span>
<span class="line highlighted"><span style="color:#000000">    </span><span style="color:#800000">&lt;/</span><span style="color:#267F99">VerySlowToRender</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000">  )</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>So in this case the problem is that when you hover the <code>div</code> the entire component will rerender, including the slow part. One way to solve this might be to try wrapping the slow component in some memoization or breaking out the <code>div</code> that is being hovered into its own component, but sometime that might feel like overkill.</p>
<p>What we could do instead is to use our previously defined <code>Hover</code> component with a render prop!</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="jsx" data-theme="default"><span class="line"><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">MyComponent</span><span style="color:#000000">() {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> (</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#800000">&lt;</span><span style="color:#267F99">VerySlowToRender</span><span style="color:#800000">&gt;</span></span>
<span class="line highlighted"><span style="color:#000000">      </span><span style="color:#800000">&lt;</span><span style="color:#267F99">Hover</span><span style="color:#800000">&gt;</span></span>
<span class="line highlighted"><span style="color:#000000">        </span><span style="color:#0000FF">{</span><span style="color:#000000FF">([</span><span style="color:#001080">hoverRef</span><span style="color:#000000FF">, </span><span style="color:#001080">isHovered</span><span style="color:#000000FF">]) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000FF"> {</span></span>
<span class="line highlighted"><span style="color:#000000FF">          </span><span style="color:#AF00DB">return</span><span style="color:#000000FF"> </span><span style="color:#800000">&lt;div</span><span style="color:#000000FF"> </span><span style="color:#FF0000">ref</span><span style="color:#000000">=</span><span style="color:#0000FF">{</span><span style="color:#001080">hoverRef</span><span style="color:#0000FF">}</span><span style="color:#800000">&gt;</span><span style="color:#0000FF">{</span><span style="color:#001080">isHovered</span><span style="color:#000000FF"> </span><span style="color:#000000">?</span><span style="color:#000000FF"> </span><span style="color:#A31515">&#x27;ðŸ˜ƒ&#x27;</span><span style="color:#000000FF"> </span><span style="color:#000000">:</span><span style="color:#000000FF"> </span><span style="color:#A31515">&#x27;ðŸ˜ž&#x27;</span><span style="color:#0000FF">}</span><span style="color:#800000">&lt;/div&gt;</span></span>
<span class="line highlighted"><span style="color:#000000FF">        }</span><span style="color:#0000FF">}</span></span>
<span class="line highlighted"><span style="color:#000000">      </span><span style="color:#800000">&lt;/</span><span style="color:#267F99">Hover</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#800000">&lt;/</span><span style="color:#267F99">VerySlowToRender</span><span style="color:#800000">&gt;</span></span>
<span class="line"><span style="color:#000000">  )</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>Now when we hover the only thing that&#x27;s gonna rerender is the <code>div</code>! I do think this is maybe the most opinionated use of the render prop pattern, and I can&#x27;t decide whether I prefer this over breaking it out to another component. Choice is always good though!</p>
<h2>Summary</h2>
<p>While Hooks have taken over a lot of the responsibility of render props, render props should still have a seat at the table of patterns we use when solving problems with React, as long as we use them for the right reasons.</p>
<p>Thanks for reading! ðŸ™Œ</p>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Software development is a social profession]]></title>
        <id>https://antongunnarsson.com/posts/software-development-is-a-social-profession</id>
        <link href="https://antongunnarsson.com/posts/software-development-is-a-social-profession"/>
        <updated>2019-06-02T21:05:00.000Z</updated>
        <content type="html"><![CDATA[<p>I&#x27;m a strong believer that software development is a social profession and not a technical one. And I say that as someone who has read the books on clean code and test-driven development, watched the talks on type systems and listened to everyone who preached about all the other hot fuzz methodologies and technologies. I&#x27;ve enjoyed it thoroughly and learned much, but the more experience I get the more I feel like we as a community need to shift our focus from the nitty-gritty technical details to <em>The Real Problemsâ„¢</em>.</p>
<p>What would you say is the single most important part of a successful software project? The methodologies we use? React or Vue? TDD or not? Tabs or spaces?</p>
<h4>No, <strong>the most important part of any software project is its people</strong>.</h4>
<p>I believe that the developer community has become so focused on the newest frameworks, the coolest libraries and the quickest way to learn it all that we&#x27;ve lost ourselves in a maze of programming languages and buzzwords. I constantly see discussions (mostly online) about programming topics turn toxic and people personally attacking each other for not sharing their opinion. This shouldn&#x27;t be necessary and I think one way forward is to talk about the human issues we all face more than we do today.</p>
<p>In 2012 Google did an internal research study called <a href="https://www.nytimes.com/2016/02/28/magazine/what-google-learned-from-its-quest-to-build-the-perfect-team.html">Project Aristotle</a> that investigated what makes a team at Google successful. They concluded that the number one key factor of a successful team is <strong>psychological safety</strong>. The big problem that follows is that people are complex. It&#x27;s much easier for us to discuss which framework to choose than it is to talk about what makes us feel safe at work. React vs Vue is concrete. <em>Feelings</em> are not.</p>
<p>And despite most companies being very good at talking about how they take care of their employees&#x27; and how the employees health always comes first, there are still many reports on <a href="https://kotaku.com/more-and-more-game-makers-are-talking-about-crunch-1829994459">crunch in the gaming industry</a>, over <a href="https://hn.algolia.com/?query=burnout&amp;sort=byPopularity&amp;prefix&amp;page=0&amp;dateRange=all&amp;type=story">700 posts</a> about burnout on HackerNews and many <a href="https://dev.to/tyler_potts_/developers-burnout-i-burned-out-3n4k">articles</a> and <a href="https://dev.to/andrejnaumovski/what-having-a-programmer-burnout-at-age-21-feels-like-3pl">great discussions</a> about <a href="(https://dev.to/mary_grace/burnout-what-happens-when-you-take-on-too-much-74d)">it</a> at <a href="https://dev.to/molly_struve/i-cant-do-it-all-my-burnout-story-1e54">dev.to</a>.</p>
<p>Software development is a relatively young industry, and these are issues other industries struggle with as well, but we are also an industry with an incredibly engaged community. How many other professions can say that you can learn everything you need to get a job for free on the internet? Or that so many amazing people share what they know without requiring anything in return? It&#x27;s a knowledge sharing culture that should impress everyone.</p>
<p>As developers we are very quick to show off our projects in portfolios and on GitHub, taking immense pride in our technical skills (and we should!), but we need to shift our focus from just the technologies we use to the people we are working with. I want to see more discussions like this thread about why <a href="https://twitter.com/hillelogram/status/1119709859979714560">sleep might matter more than technical skills</a>, or the feeling of not keeping up with the industry because so much is changing so fast, or how to combine family life with working in tech. I want us to talk about what it is like being a human in the context of software development, instead of <em>just</em> talking about the technical bits of software.</p>
<p>BrenÃ© Brown is a researcher and author that has studied vulnerability, courage, shame, and empathy. She is a huge inspiration to me, and I wholeheartedly recommend reading her books (or watching her recent <a href="https://www.netflix.com/title/81010166">Netflix show</a>). In her book Dare to Lead she writes:</p>
<blockquote>
<p>&quot;I define a leader as anyone who takes responsibility for finding the potential in people and processes, and who has the courage to develop that potential.&quot;</p>
</blockquote>
<p>This is what I wish we would do. Use our empathy and vulnerability to help ourselves and other developers. For most of us, this will most likely be scary. I know it is for me. Talking about real feelings puts you in a very vulnerable position, but it&#x27;s also how we build trust and how we grow as human beings.</p>
<p>Software development is a social profession because without the interaction between people, there would be no software. Frameworks wouldn&#x27;t grow, ideas wouldn&#x27;t spread and projects would fail. We should all strive to go to work and feel that there is joy in what we do, that we can contribute, that what we do matter. And we should strive to make our colleagues feel the same.</p>
<blockquote>
<p>&quot;What we know matters but who we are matters more.&quot; - BrenÃ© Brown</p>
</blockquote>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[The past decade]]></title>
        <id>https://antongunnarsson.com/posts/the-past-decade</id>
        <link href="https://antongunnarsson.com/posts/the-past-decade"/>
        <updated>2020-01-11T21:05:00.000Z</updated>
        <content type="html"><![CDATA[<p>I&#x27;m usually not one for doing huge retrospectives but I got caught up in a conversation with a friend about what we&#x27;ve done this past decade and realized I easily forget what I&#x27;ve accomplished. So to much of my own benefit, here&#x27;s a short run through of the past 10 years of my life.</p>
<h2>2010</h2>
<p>I graduated high school at Staffangymnasiet in SÃ¶derhamn, where I&#x27;ve grown up and lived my entire life up to this point. After a short summer break I got a job as a customer service agent at a telecom company.</p>
<h2>2011</h2>
<p>Met my first serious girlfriend and moved to my first apartment. I was promoted to work with second-line support (ie the <em>tough stuff</em>).</p>
<h2>2012</h2>
<p>I was promoted to work with educations before moving to Uppsala where I got a job as a telemarketer selling insurance.</p>
<h2>2013</h2>
<p>After 6 months of telemarketing my employer realized I was a horrible telemarketer so I got fired. Started working from home with customer service for Apple, before starting studies in Informatics at Uppsala University.</p>
<h2>2014</h2>
<p>I was one of two project leaders for the student orientation for Informatics students, and later that year I was elected vice president of the Informatics Student Association. Also started a company called Lyxit with a friend where we did some consultancy work but mainly developed apps and games.</p>
<h2>2015</h2>
<p>Continued my studies. Had a short project employment over the summer building a hybrid app with <a href="https://cordova.apache.org/">Cordova</a>.</p>
<h2>2016</h2>
<p>I graduated University and started my first real developer job at a company called Avanade Sweden. In November me and a couple of university friends decided to start a Swedish podcast, <a href="https://podcasts.apple.com/se/podcast/still-in-beta/id1174070946">Still in Beta</a>, about being a rookie developer.</p>
<h2>2017</h2>
<p>Me and my girlfriend broke up. Me and my friend decided it was time to officially kill our company Lyxit after quite some time of inactivity.</p>
<h2>2018</h2>
<p>During the summer I realized that I wasn&#x27;t happy at work and started thinking about moving on so I started looking for new opportunities. Two years and 20 episodes after starting our podcast Still in Beta was shut down.</p>
<h2>2019</h2>
<p>In February I started my new job at <a href="https://www.mpyadigital.com">Mpya Digital</a>, which so far feels like it might be the best decision of the decade.</p>
<h2>2020?</h2>
<p>At the end of 2019 I was quite exhausted as a result of doing a bit too much of everything at the same time. But after some time offline from everything over the holidays I&#x27;m going into this new year and new decade with such a positive energy, feeling better than I&#x27;ve done in years.</p>
<p>I&#x27;ll get back to you in 10 years with how it went.</p>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Troubleshooting NodeJS memory leaks with node-memwatch]]></title>
        <id>https://antongunnarsson.com/posts/troubleshooting-nodejs-memory-leaks</id>
        <link href="https://antongunnarsson.com/posts/troubleshooting-nodejs-memory-leaks"/>
        <updated>2020-05-26T20:17:00.000Z</updated>
        <content type="html"><![CDATA[<p>I recently released my social drawing game <a href="https://draw.wtf">draw.wtf</a> where you compete against each other by drawing things and getting judged by a machine learning model. While I&#x27;ve gotten a lot of positive feedback since I released it, I also quickly discovered that <em>something</em> was wrong. The backend for the game is written in <a href="https://nestjs.com/">Nest</a> (node) and hosted on <a href="https://heroku.com">Heroku</a> (which I can really recommend, their free tier is great for passion projects). But looking at the memory usage in the metrics overview I could clearly see that things we&#x27;re not alright:</p>
<p><span style="box-sizing:border-box;display:block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;padding-top:30.551181102362207%"></span><img alt="memory graph at 110%" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="memory graph at 110%" sizes="100vw" srcSet="/_next/image?url=%2Fmemory-usage.png&amp;w=640&amp;q=75 640w, /_next/image?url=%2Fmemory-usage.png&amp;w=750&amp;q=75 750w, /_next/image?url=%2Fmemory-usage.png&amp;w=828&amp;q=75 828w, /_next/image?url=%2Fmemory-usage.png&amp;w=1080&amp;q=75 1080w, /_next/image?url=%2Fmemory-usage.png&amp;w=1200&amp;q=75 1200w, /_next/image?url=%2Fmemory-usage.png&amp;w=1920&amp;q=75 1920w, /_next/image?url=%2Fmemory-usage.png&amp;w=2048&amp;q=75 2048w, /_next/image?url=%2Fmemory-usage.png&amp;w=3840&amp;q=75 3840w" src="https://antongunnarsson.com/_next/image?url=%2Fmemory-usage.png&amp;w=3840&amp;q=75" decoding="async" data-nimg="responsive" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p>
<p>There was no way that my game would use this much memory so it was clear that I had a <em>memory leak</em>.</p>
<p>A memory leak is when an application uses memory (RAM) without eventually releasing it. Most modern (high level) programming languages today implement some sort of automatic cleanup of unused memory and Node uses something called a <a href="https://en.wikipedia.org/wiki/Garbage_collection_(computer_science)">&quot;garbage collector&quot;</a>. For the sake of this debugging story that&#x27;s all you need to know!</p>
<p>Back to the issue in draw.wtf! I have almost only worked in languages with garbage collection so starting to troubleshoot this issue I had no experience with finding memory leaks. My first thought was just to skim the code and find the issue buuut to no avail. I had no idea where in the code the bug might live, and since we don&#x27;t do any manual handling of memory there <em>shouldn&#x27;t</em> exist any bugs! :(</p>
<p>The next step was to reach for the most common tool in every developers toolbox: Google!</p>
<p>I read <em>a lot</em> of articles on finding memory issues in node, but none that led me close to a solution. Finally I found an article that recommended the library <a href="https://github.com/lloyd/node-memwatch">node-memwatch</a> which looked promising! Unfortunately it hasn&#x27;t been updated for 7 years...</p>
<h3>Open source to the rescue! ðŸš€</h3>
<p>Looking at the <a href="https://github.com/lloyd/node-memwatch/network/members">forks</a> of node-memwatch we can try finding one that is still maintained, and after looking through a couple I ended up with <a href="https://github.com/airbnb/node-memwatch">this fork</a> from AirBnB.</p>
<p>Heading back into the code I started by testing the librarys <a href="https://github.com/airbnb/node-memwatch#heap-diffing">heap diffing</a> by running <code>new memwatch.HeapDiff();</code> and <code>heapDiff.end();</code> which outputs before and after memory usage. And sure enough, I can see the memory grow with about 2mb for every round played in the game.</p>
<p>One thing I did discover when testing this was that the memory <em>did not</em> grow when I didn&#x27;t draw anything! ðŸ¤” This was really great since it narrowed down where in the code the issue is. With this knowledge I moved the heap diffing functions to a couple of different places where drawn lines are handled, and THIS led me to the function that was leaking memory: calculating scores.</p>
<p>To calculate the scores I have a machine learning model trained with <a href="https://www.customvision.ai/">Azure Custom Vision</a> and then runs it locally with <a href="https://www.tensorflow.org/">TensorFlow</a>. Here is the implementation of this calculation function, with the memory leak issue intact:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="js" data-theme="default"><span class="line"><span style="color:#0000FF">async</span><span style="color:#000000"> </span><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">calculate</span><span style="color:#000000">(</span><span style="color:#001080">pixels</span><span style="color:#000000">) {</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">inputs</span><span style="color:#000000"> = </span><span style="color:#001080">pixels</span><span style="color:#000000"> </span><span style="color:#0000FF">instanceof</span><span style="color:#000000"> </span><span style="color:#267F99">tf</span><span style="color:#000000">.</span><span style="color:#267F99">Tensor</span><span style="color:#000000"> ? </span><span style="color:#001080">pixels</span><span style="color:#000000"> : </span><span style="color:#0000FF">this</span><span style="color:#000000">.</span><span style="color:#795E26">_preprocess</span><span style="color:#000000">(</span><span style="color:#001080">tf</span><span style="color:#000000">.</span><span style="color:#001080">browser</span><span style="color:#000000">.</span><span style="color:#795E26">fromPixels</span><span style="color:#000000">(</span><span style="color:#001080">pixels</span><span style="color:#000000">, </span><span style="color:#098658">3</span><span style="color:#000000">))</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">outputs</span><span style="color:#000000"> = </span><span style="color:#AF00DB">await</span><span style="color:#000000"> </span><span style="color:#0000FF">this</span><span style="color:#000000">.</span><span style="color:#001080">model</span><span style="color:#000000">.</span><span style="color:#795E26">execute</span><span style="color:#000000">(</span><span style="color:#001080">inputs</span><span style="color:#000000">, </span><span style="color:#0000FF">null</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">arrays</span><span style="color:#000000"> = !</span><span style="color:#267F99">Array</span><span style="color:#000000">.</span><span style="color:#795E26">isArray</span><span style="color:#000000">(</span><span style="color:#001080">outputs</span><span style="color:#000000">) ? </span><span style="color:#AF00DB">await</span><span style="color:#000000"> </span><span style="color:#001080">outputs</span><span style="color:#000000">.</span><span style="color:#795E26">array</span><span style="color:#000000">() : </span><span style="color:#267F99">Promise</span><span style="color:#000000">.</span><span style="color:#795E26">all</span><span style="color:#000000">(</span><span style="color:#001080">outputs</span><span style="color:#000000">.</span><span style="color:#795E26">map</span><span style="color:#000000">((</span><span style="color:#001080">t</span><span style="color:#000000">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> </span><span style="color:#001080">t</span><span style="color:#000000">.</span><span style="color:#795E26">array</span><span style="color:#000000">()))</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">result</span><span style="color:#000000"> = </span><span style="color:#267F99">Array</span><span style="color:#000000">.</span><span style="color:#795E26">isArray</span><span style="color:#000000">(</span><span style="color:#001080">arrays</span><span style="color:#000000">[</span><span style="color:#098658">0</span><span style="color:#000000">]) ? </span><span style="color:#001080">arrays</span><span style="color:#000000">[</span><span style="color:#098658">0</span><span style="color:#000000">].</span><span style="color:#795E26">map</span><span style="color:#000000">((</span><span style="color:#001080">x</span><span style="color:#000000">, </span><span style="color:#001080">i</span><span style="color:#000000">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> ({ </span><span style="color:#001080">probability:</span><span style="color:#000000"> </span><span style="color:#001080">x</span><span style="color:#000000">, </span><span style="color:#001080">tag:</span><span style="color:#000000"> </span><span style="color:#0000FF">this</span><span style="color:#000000">.</span><span style="color:#001080">tags</span><span style="color:#000000">[</span><span style="color:#001080">i</span><span style="color:#000000">] })) : []</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#001080">result</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p>Do you see the issue? (It&#x27;s not in the <code>_preprocess</code> function).</p>
<p>I sure didn&#x27;t, no matter how much I looked at this code so next up I dived into the TensorFlow.js documentation where I found <a href="https://www.tensorflow.org/js/guide/tensors_operations#memory">this little nugget</a> of wisdom:</p>
<blockquote>
<p><em>&quot;When using the WebGL backend, tf.Tensor memory must be managed explicitly (it is not sufficient to let a tf.Tensor go out of scope for its memory to be released).&quot;</em></p>
</blockquote>
<p>Aaah, the solution! With that it wasn&#x27;t very hard to read some more documentation and end up with a score calculation that works:</p>
<div data-rehype-pretty-code-fragment=""><pre class="Code__Pre-sc-6f647feb-0 EkYbS"><code data-language="ts" data-theme="default"><span class="line"><span style="color:#0000FF">async</span><span style="color:#000000"> </span><span style="color:#0000FF">function</span><span style="color:#000000"> </span><span style="color:#795E26">calculate</span><span style="color:#000000">(</span><span style="color:#001080">pixels</span><span style="color:#000000">) {</span></span>
<span class="line highlighted"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">inputs</span><span style="color:#000000"> = </span><span style="color:#001080">tf</span><span style="color:#000000">.</span><span style="color:#795E26">tidy</span><span style="color:#000000">(() </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> {</span></span>
<span class="line"><span style="color:#000000">    </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#001080">pixels</span><span style="color:#000000"> </span><span style="color:#0000FF">instanceof</span><span style="color:#000000"> </span><span style="color:#267F99">tf</span><span style="color:#000000">.</span><span style="color:#267F99">Tensor</span><span style="color:#000000"> ? </span><span style="color:#001080">pixels</span><span style="color:#000000"> : </span><span style="color:#0000FF">this</span><span style="color:#000000">.</span><span style="color:#795E26">_preprocess</span><span style="color:#000000">(</span><span style="color:#001080">tf</span><span style="color:#000000">.</span><span style="color:#001080">browser</span><span style="color:#000000">.</span><span style="color:#795E26">fromPixels</span><span style="color:#000000">(</span><span style="color:#001080">pixels</span><span style="color:#000000">, </span><span style="color:#098658">3</span><span style="color:#000000">))</span></span>
<span class="line"><span style="color:#000000">  })</span></span>
<span class="line"> </span>
<span class="line highlighted"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">outputs</span><span style="color:#000000"> = </span><span style="color:#AF00DB">await</span><span style="color:#000000"> </span><span style="color:#0000FF">this</span><span style="color:#000000">.</span><span style="color:#001080">model</span><span style="color:#000000">.</span><span style="color:#795E26">execute</span><span style="color:#000000">(</span><span style="color:#001080">inputs</span><span style="color:#000000">, </span><span style="color:#0000FF">null</span><span style="color:#000000">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">arrays</span><span style="color:#000000"> = !</span><span style="color:#267F99">Array</span><span style="color:#000000">.</span><span style="color:#795E26">isArray</span><span style="color:#000000">(</span><span style="color:#001080">outputs</span><span style="color:#000000">) ? </span><span style="color:#AF00DB">await</span><span style="color:#000000"> </span><span style="color:#001080">outputs</span><span style="color:#000000">.</span><span style="color:#795E26">array</span><span style="color:#000000">() : </span><span style="color:#267F99">Promise</span><span style="color:#000000">.</span><span style="color:#795E26">all</span><span style="color:#000000">(</span><span style="color:#001080">outputs</span><span style="color:#000000">.</span><span style="color:#795E26">map</span><span style="color:#000000">((</span><span style="color:#001080">t</span><span style="color:#000000">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> </span><span style="color:#001080">t</span><span style="color:#000000">.</span><span style="color:#795E26">array</span><span style="color:#000000">()))</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#0000FF">const</span><span style="color:#000000"> </span><span style="color:#0070C1">result</span><span style="color:#000000"> = </span><span style="color:#267F99">Array</span><span style="color:#000000">.</span><span style="color:#795E26">isArray</span><span style="color:#000000">(</span><span style="color:#001080">arrays</span><span style="color:#000000">[</span><span style="color:#098658">0</span><span style="color:#000000">]) ? </span><span style="color:#001080">arrays</span><span style="color:#000000">[</span><span style="color:#098658">0</span><span style="color:#000000">].</span><span style="color:#795E26">map</span><span style="color:#000000">((</span><span style="color:#001080">x</span><span style="color:#000000">, </span><span style="color:#001080">i</span><span style="color:#000000">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> ({ </span><span style="color:#001080">probability:</span><span style="color:#000000"> </span><span style="color:#001080">x</span><span style="color:#000000">, </span><span style="color:#001080">tag:</span><span style="color:#000000"> </span><span style="color:#0000FF">this</span><span style="color:#000000">.</span><span style="color:#001080">tags</span><span style="color:#000000">[</span><span style="color:#001080">i</span><span style="color:#000000">] })) : []</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#001080">inputs</span><span style="color:#000000">.</span><span style="color:#795E26">dispose</span><span style="color:#000000">()</span></span>
<span class="line"><span style="color:#000000">  </span><span style="color:#267F99">Array</span><span style="color:#000000">.</span><span style="color:#795E26">isArray</span><span style="color:#000000">(</span><span style="color:#001080">outputs</span><span style="color:#000000">) ? </span><span style="color:#001080">outputs</span><span style="color:#000000">.</span><span style="color:#795E26">forEach</span><span style="color:#000000">((</span><span style="color:#001080">o</span><span style="color:#000000">) </span><span style="color:#0000FF">=&gt;</span><span style="color:#000000"> </span><span style="color:#001080">o</span><span style="color:#000000">.</span><span style="color:#795E26">dispose</span><span style="color:#000000">()) : </span><span style="color:#001080">outputs</span><span style="color:#000000">.</span><span style="color:#795E26">dispose</span><span style="color:#000000">()</span></span>
<span class="line"> </span>
<span class="line"><span style="color:#000000">  </span><span style="color:#AF00DB">return</span><span style="color:#000000"> </span><span style="color:#001080">result</span></span>
<span class="line"><span style="color:#000000">}</span></span></code></pre></div>
<p><code>tf.tidy()</code> automatically disposes of any <code>tf.Tensor</code> created within, and then I manually run <code>dispose()</code> on any tensor I have to create outside of it. And that&#x27;s it! Now the memory isn&#x27;t leaking any more:</p>
<p><span style="box-sizing:border-box;display:block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;padding-top:16.049382716049383%"></span><img alt="memory graph at 23%" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="memory graph at 23%" sizes="100vw" srcSet="/_next/image?url=%2Fmemory-usage-2.png&amp;w=640&amp;q=75 640w, /_next/image?url=%2Fmemory-usage-2.png&amp;w=750&amp;q=75 750w, /_next/image?url=%2Fmemory-usage-2.png&amp;w=828&amp;q=75 828w, /_next/image?url=%2Fmemory-usage-2.png&amp;w=1080&amp;q=75 1080w, /_next/image?url=%2Fmemory-usage-2.png&amp;w=1200&amp;q=75 1200w, /_next/image?url=%2Fmemory-usage-2.png&amp;w=1920&amp;q=75 1920w, /_next/image?url=%2Fmemory-usage-2.png&amp;w=2048&amp;q=75 2048w, /_next/image?url=%2Fmemory-usage-2.png&amp;w=3840&amp;q=75 3840w" src="https://antongunnarsson.com/_next/image?url=%2Fmemory-usage-2.png&amp;w=3840&amp;q=75" decoding="async" data-nimg="responsive" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p>
<p>To finish this up, if you&#x27;re gonna take anything with you from this post I think it should be that <code>node-memwatch</code> is a pretty nice tool for troubleshooting memory issues. If there is something you should <em>not</em> take with you, it&#x27;s probably the code samples. I have no idea if they&#x27;re good, bad or ugly ðŸ˜…</p>]]></content>
    </entry>
</feed>